{"id": "CVE-2024-35832", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-05-17T14:15:19.710", "lastModified": "2024-05-17T18:35:35.070", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nbcachefs: kvfree bch_fs::snapshots in bch2_fs_snapshots_exit\n\nbch_fs::snapshots is allocated by kvzalloc in __snapshot_t_mut.\nIt should be freed by kvfree not kfree.\nOr umount will triger:\n\n[  406.829178 ] BUG: unable to handle page fault for address: ffffe7b487148008\n[  406.830676 ] #PF: supervisor read access in kernel mode\n[  406.831643 ] #PF: error_code(0x0000) - not-present page\n[  406.832487 ] PGD 0 P4D 0\n[  406.832898 ] Oops: 0000 [#1] PREEMPT SMP PTI\n[  406.833512 ] CPU: 2 PID: 1754 Comm: umount Kdump: loaded Tainted: G           OE      6.7.0-rc7-custom+ #90\n[  406.834746 ] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Arch Linux 1.16.3-1-1 04/01/2014\n[  406.835796 ] RIP: 0010:kfree+0x62/0x140\n[  406.836197 ] Code: 80 48 01 d8 0f 82 e9 00 00 00 48 c7 c2 00 00 00 80 48 2b 15 78 9f 1f 01 48 01 d0 48 c1 e8 0c 48 c1 e0 06 48 03 05 56 9f 1f 01 <48> 8b 50 08 48 89 c7 f6 c2 01 0f 85 b0 00 00 00 66 90 48 8b 07 f6\n[  406.837810 ] RSP: 0018:ffffb9d641607e48 EFLAGS: 00010286\n[  406.838213 ] RAX: ffffe7b487148000 RBX: ffffb9d645200000 RCX: ffffb9d641607dc4\n[  406.838738 ] RDX: 000065bb00000000 RSI: ffffffffc0d88b84 RDI: ffffb9d645200000\n[  406.839217 ] RBP: ffff9a4625d00068 R08: 0000000000000001 R09: 0000000000000001\n[  406.839650 ] R10: 0000000000000001 R11: 000000000000001f R12: ffff9a4625d4da80\n[  406.840055 ] R13: ffff9a4625d00000 R14: ffffffffc0e2eb20 R15: 0000000000000000\n[  406.840451 ] FS:  00007f0a264ffb80(0000) GS:ffff9a4e2d500000(0000) knlGS:0000000000000000\n[  406.840851 ] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[  406.841125 ] CR2: ffffe7b487148008 CR3: 000000018c4d2000 CR4: 00000000000006f0\n[  406.841464 ] Call Trace:\n[  406.841583 ]  <TASK>\n[  406.841682 ]  ? __die+0x1f/0x70\n[  406.841828 ]  ? page_fault_oops+0x159/0x470\n[  406.842014 ]  ? fixup_exception+0x22/0x310\n[  406.842198 ]  ? exc_page_fault+0x1ed/0x200\n[  406.842382 ]  ? asm_exc_page_fault+0x22/0x30\n[  406.842574 ]  ? bch2_fs_release+0x54/0x280 [bcachefs]\n[  406.842842 ]  ? kfree+0x62/0x140\n[  406.842988 ]  ? kfree+0x104/0x140\n[  406.843138 ]  bch2_fs_release+0x54/0x280 [bcachefs]\n[  406.843390 ]  kobject_put+0xb7/0x170\n[  406.843552 ]  deactivate_locked_super+0x2f/0xa0\n[  406.843756 ]  cleanup_mnt+0xba/0x150\n[  406.843917 ]  task_work_run+0x59/0xa0\n[  406.844083 ]  exit_to_user_mode_prepare+0x197/0x1a0\n[  406.844302 ]  syscall_exit_to_user_mode+0x16/0x40\n[  406.844510 ]  do_syscall_64+0x4e/0xf0\n[  406.844675 ]  entry_SYSCALL_64_after_hwframe+0x6e/0x76\n[  406.844907 ] RIP: 0033:0x7f0a2664e4fb"}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: bcachefs: kvfree bch_fs::snapshots en bch2_fs_snapshots_exit bch_fs::snapshots es asignado por kvzalloc en __snapshot_t_mut. Deber\u00eda ser liberado por kvfree, no por kfree. O desmontar activar\u00e1: [406.829178] ERROR: no se puede manejar el error de p\u00e1gina para la direcci\u00f3n: ffffe7b487148008 [406.830676] #PF: acceso de lectura del supervisor en modo kernel [406.831643] #PF: error_code(0x0000) - p\u00e1gina no presente [406.832487] PGD 0 P4D 0 [ 406.832898 ] Vaya: 0000 [#1] PREEMPT SMP PTI [ 406.833512 ] CPU: 2 PID: 1754 Comunicaciones: desmontar Kdump: cargado Contaminado: G OE 6.7.0-rc7-custom+ #90 [ 406.834746 ] Nombre de hardware: PC est\u00e1ndar QEMU (i440FX + PIIX, 1996), BIOS Arch Linux 1.16.3-1-1 01/04/2014 [ 406.835796 ] RIP: 0010:kfree+0x62/0x140 [ 406.836197 ] C\u00f3digo: 80 48 01 d8 0f 82 e9 00 00 00 48 c7 c2 00 00 00 80 48 2b 15 78 9f 1f 01 48 01 d0 48 c1 e8 0c 48 c1 e0 06 48 03 05 56 9f 1f 01 &lt;48&gt; 8b 50 08 48 89 c7 f6 01 0f 85b0 00 00 00 66 90 48 8b 07 f6 [ 406.837810 ] RSP: 0018:ffffb9d641607e48 EFLAGS: 00010286 [ 406.838213 ] RAX: ffffe7b487148000 RBX: 0000 RCX: ffffb9d641607dc4 [ 406.838738 ] RDX: 000065bb00000000 RSI: ffffffffc0d88b84 RDI: ffffb9d645200000 [ 406.839217 ] RBP: ffff9a4625d00068 R08: 0000000000000001 R09: 00000000000000001 [ 406.839650 ] R10: 0000000000000001 R11: 000000000000001f R12: ffff9a4625d4da80 [ 406.8 40055 ] R13: ffff9a4625d00000 R14: ffffffffc0e2eb20 R15: 0000000000000000 [ 406.840451 ] FS: 00007f0a264ffb80(0000) GS:ffff9a4e2d500000(0000) knlGS:0000000000000000 [ 406.840851 ] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [ 406.841125 ] CR2: ffffe7b487148008 CR3: 000000018c4d2000 CR4: 00000000000006f0 [ 406.841 464 ] Seguimiento de llamadas: [ 406.841583 ]  [ 406.841682 ] ? __die+0x1f/0x70 [ 406.841828 ] ? page_fault_oops+0x159/0x470 [406.842014]? fixup_exception+0x22/0x310 [406.842198]? exc_page_fault+0x1ed/0x200 [406.842382]? asm_exc_page_fault+0x22/0x30 [406.842574]? bch2_fs_release+0x54/0x280 [bcachefs] [406.842842]? kfree+0x62/0x140 [ 406.842988 ] ? kfree+0x104/0x140 [ 406.843138 ] bch2_fs_release+0x54/0x280 [bcachefs] [ 406.843390 ] kobject_put+0xb7/0x170 [ 406.843552 ] desactivar_locked_super+0x2f/0xa0 [ 406.843 756 ] cleanup_mnt+0xba/0x150 [ 406.843917 ] task_work_run+0x59/0xa0 [ 406.844083 ] exit_to_user_mode_prepare+0x197/0x1a0 [ 406.844302 ] syscall_exit_to_user_mode+0x16/0x40 [ 406.844510 ] do_syscall_64+0x4e/0xf0 [ 406.844675 entrada_SYSCALL_64_after_hwframe +0x6e/0x76 [ 406.844907 ] RIP: 0033:0x7f0a2664e4fb"}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/369acf97d6fd5da620d053d0f1878ffe32eff555", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/56590678791119b9a655202e49898edfb9307271", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1210", "comment": "CVE-2024-35832 - Use of an inconsistent free function (kfree vs kvfree) can lead to a use-after-free vulnerability. This technique is relevant to understand the impact of this vulnerability and defending against it by using consistent memory management functions."}, {"techniqueID": "T1169", "comment": "This vulnerability can also be used to inject arbitrary code into the system by exploiting the use-after-free vulnerability. This technique is relevant to understand the potential impact of this vulnerability and defending against it by securing the code execution processes."}], "stix_bundle": {"type": "bundle", "id": "bundle--98897a23-4b50-4141-8f69-30a15eef5e3a", "spec_version": "2.1", "objects": [{"type": "vulnerability", "id": "vulnerability--5a0d6b23-5f41-4a54-8179-1baf3cc6a5eb", "created_by_ref": "identity--f9e5c443-9468-4438-a3e7-a5dd8dd9b8bb", "modified": "2024-05-17T14:15:19.710Z", "names": ["BCACHEFS: kvfree bch_fs::snapshots in bch2_fs_snapshots_exit"], "short_description": "BCACHEFS: kvfree bch_fs::snapshots in bch2_fs_snapshots_exit", "description": "In the Linux kernel, the following vulnerability has been resolved: bcachefs: kvfree bch_fs::snapshots in bch2_fs_snapshots_exit", "cve_ids": ["CVE-2024-35832"]}, {"type": "campaign", "id": "campaign--345b4f23-54a3-4f41-a8f7-e2d15eef5e3a", "created_by_ref": "identity--f9e5c443-9468-4438-a3e7-a5dd8dd9b8bb", "modified": "2024-05-17T14:15:19.710Z", "names": ["Linux Kernel Vulnerability"], "description": "A campaign designed to exploit the Linux kernel vulnerability"}, {"type": "malware", "id": "malware--a3e4f23-54a3-4f41-a8f7-e2d15eef5e3a", "created_by_ref": "identity--f9e5c443-9468-4438-a3e7-a5dd8dd9b8bb", "modified": "2024-05-17T14:15:19.710Z", "names": ["Linux Kernel Exploit"], "description": "A malware designed to exploit the Linux kernel vulnerability"}, {"type": "course-of-action", "id": "course-of-action--e2d4f23-54a3-4f41-a8f7-e2d15eef5e3a", "created_by_ref": "identity--f9e5c443-9468-4438-a3e7-a5dd8dd9b8bb", "modified": "2024-05-17T14:15:19.710Z", "names": ["Secure Code Execution"], "description": "Secure code execution to prevent exploitation of use-after-free vulnerability", "related_to": {"type": "related-object", "object_ref": "technique--T1169", "relationship": "mitigates"}}]}, "technical_analysis": {"Introduction": "Linux kernel vulnerability CVE-2024-35832 is a use-after-free vulnerability in the bcachefs module, allowing arbitrary code execution. This vulnerability is classified as High severity based on the CVSS score of 9.8.", "Impact and Scope": "This vulnerability affects the Linux kernel and can lead to arbitrary code execution, allowing an attacker to take control of the system. The vulnerability is present in the bcachefs module of the kernel.", "Related MITRE ATT&CK Techniques": "T1210, T1169", "Technical Details": "The vulnerability is caused by a use-after-free error in the bcachefs module, which can be exploited by an attacker to inject arbitrary code into the system.", "Detection": "Detection can be done by monitoring system logs for suspicious activity and by performing regular system security audits.", "Mitigation": "The vulnerability can be mitigated by securing code execution processes and by implementing memory protection mechanisms.", "Conclusion": "In conclusion, the vulnerability CVE-2024-35832 is a high-severity vulnerability that requires immediate attention and mitigation to prevent exploitation."}, "executive_analysis": {"Overview": "Linux kernel vulnerability CVE-2024-35832 is a high-severity vulnerability that can lead to arbitrary code execution and system compromise.", "Business Impact": "This vulnerability can have significant business impact, as it can allow an attacker to take control of the system, leading to data theft, disruption of services, and reputational damage.", "Technical Impact": "The vulnerability is present in the bcachefs module of the kernel, which affects the Linux kernel.", "Mitigation Strategies": "Secure code execution processes, implement memory protection mechanisms, and perform regular system security audits.", "Recommendations": "Implement the recommended mitigation strategies to prevent exploitation of this vulnerability.", "Conclusions": "In conclusion, prompt attention and mitigation of this vulnerability is necessary to prevent exploitation and potential system compromise."}}