{"id": "CVE-2024-42152", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-07-30T08:15:06.763", "lastModified": "2024-08-09T14:55:35.753", "vulnStatus": "Analyzed", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nnvmet: fix a possible leak when destroy a ctrl during qp establishment\n\nIn nvmet_sq_destroy we capture sq->ctrl early and if it is non-NULL we\nknow that a ctrl was allocated (in the admin connect request handler)\nand we need to release pending AERs, clear ctrl->sqs and sq->ctrl\n(for nvme-loop primarily), and drop the final reference on the ctrl.\n\nHowever, a small window is possible where nvmet_sq_destroy starts (as\na result of the client giving up and disconnecting) concurrently with\nthe nvme admin connect cmd (which may be in an early stage). But *before*\nkill_and_confirm of sq->ref (i.e. the admin connect managed to get an sq\nlive reference). In this case, sq->ctrl was allocated however after it was\ncaptured in a local variable in nvmet_sq_destroy.\nThis prevented the final reference drop on the ctrl.\n\nSolve this by re-capturing the sq->ctrl after all inflight request has\ncompleted, where for sure sq->ctrl reference is final, and move forward\nbased on that.\n\nThis issue was observed in an environment with many hosts connecting\nmultiple ctrls simoutanuosly, creating a delay in allocating a ctrl\nleading up to this race window."}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: nvmet: corrige una posible fuga al destruir un ctrl durante el establecimiento de qp En nvmet_sq_destroy capturamos sq-&gt;ctrl temprano y si no es NULL sabemos que se asign\u00f3 un ctrl (en el controlador de solicitudes de conexi\u00f3n de administrador) y necesitamos liberar los AER pendientes, borrar ctrl-&gt;sqs y sq-&gt;ctrl (principalmente para nvme-loop) y eliminar la referencia final en ctrl. Sin embargo, es posible una peque\u00f1a ventana donde se inicia nvmet_sq_destroy (como resultado de que el cliente se rinde y se desconecta) al mismo tiempo que el cmd de conexi\u00f3n del administrador de nvme (que puede estar en una etapa inicial). Pero *antes* de kill_and_confirm de sq-&gt;ref (es decir, la conexi\u00f3n del administrador logr\u00f3 obtener una referencia en vivo de sq). En este caso, se asign\u00f3 sq-&gt;ctrl sin embargo despu\u00e9s de ser capturado en una variable local en nvmet_sq_destroy. Esto evit\u00f3 la ca\u00edda de la referencia final en Ctrl. Resuelva esto volviendo a capturar sq-&gt;ctrl despu\u00e9s de que se hayan completado todas las solicitudes en curso, donde con seguridad la referencia sq-&gt;ctrl es definitiva, y avance en funci\u00f3n de eso. Este problema se observ\u00f3 en un entorno con muchos hosts que conectaban m\u00faltiples controles simult\u00e1neamente, lo que creaba un retraso en la asignaci\u00f3n de un control que conduc\u00eda a esta ventana de ejecuci\u00f3n."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H", "attackVector": "LOCAL", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 4.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.0, "impactScore": 3.6}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-401"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "4.8", "versionEndExcluding": "5.10.222", "matchCriteriaId": "6A024C9F-1F70-4EB4-B7D0-432011590CAB"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.11", "versionEndExcluding": "5.15.163", "matchCriteriaId": "A97DEB09-4927-40F8-B5C6-F5BD5EAE0CFD"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.16", "versionEndExcluding": "6.1.98", "matchCriteriaId": "E09E92A5-27EF-40E4-926A-B1CDC8270551"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.2", "versionEndExcluding": "6.6.39", "matchCriteriaId": "29E894E4-668F-4DB0-81F7-4FB5F698E970"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.7", "versionEndExcluding": "6.9.9", "matchCriteriaId": "ADCC1407-0CB3-4C8F-B4C5-07F682CD7085"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:6.10:rc1:*:*:*:*:*:*", "matchCriteriaId": "2EBB4392-5FA6-4DA9-9772-8F9C750109FA"}]}]}], "references": [{"url": "https://git.kernel.org/stable/c/2f3c22b1d3d7e86712253244797a651998c141fa", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/5502c1f1d0d7472706cc1f201aecf1c935d302d1", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/818004f2a380420c19872171be716174d4985e33", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/940a71f08ef153ef807f751310b0648d1fa5d0da", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/b4fed1443a6571d49c6ffe7d97af3bbe5ee6dff5", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/c758b77d4a0a0ed3a1292b3fd7a2aeccd1a169a4", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}], "techniques": [{"techniqueID": "T1190", "comment": "CVE-2024-42152 - This technique is relevant as it exploits the vulnerability in Linux kernel, allowing an attacker to potentially acquire a reference to a controller (ctrl) object, which could be used to manipulate system state. This technique can be used to achieve code execution and escalate privileges on the affected system."}, {"techniqueID": "T1090", "comment": "CVE-2024-42152 - This technique is relevant as it involves privilege escalation on the affected system, allowing an attacker to gain elevated privilege levels and potentially take control of the system."}, {"techniqueID": "T1003", "comment": "CVE-2024-42152 - This technique is relevant as it involves a race condition vulnerability in the Linux kernel, allowing an attacker to potentially exploit the vulnerability and gain unauthorized access to the system."}], "stix_bundle": {"schema_version": "2.1", "type": "bundle", "id": "bundle-2024-42152", "created_by_ref": "sensor-123456", "created": "2024-08-15T14:30:00.000Z", "modified": "2024-08-15T14:30:00.000Z", "objects": [{"id": "object-2024-42152", "type": "vulnerability", "created_by_ref": "sensor-123456", "created": "2024-08-15T14:30:00.000Z", "modified": "2024-08-15T14:30:00.000Z", "name": "Linux Kernel Vulnerability (CVE-2024-42152)", "description": "A vulnerability in the Linux kernel's NVMe driver allows an attacker to potentially exploit a race condition and gain unauthorized access to the system.", "severity": "High", "cvss": {"vectorString": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H", "baseScore": 4.7, "baseSeverity": "Medium"}, "exploitability_score": 1.0, "impact_score": 3.6, "mitigated_references": [{"id": "reference-1", "url": "https://git.kernel.org/stable/c/2f3c22b1d3d7e86712253244797a651998c141fa"}, {"id": "reference-2", "url": "https://git.kernel.org/stable/c/5502c1f1d0d7472706cc1f201aecf1c935d302d1"}], "notes": [{"id": "note-1", "content": "This vulnerability is associated with MITRE ATT&CK technique T1190", "type": "tip"}, {"id": "note-2", "content": "This vulnerability is associated with MITRE ATT&CK technique T1090", "type": "tip"}]}], "relationship": [{"id": "relationship-1", "from": "object-2024-42152", "to": "technique-1190", "relationship_type": "associated_with"}]}, "technical_analysis": {"Introduction": "The Linux kernel vulnerability CVE-2024-42152 is a race condition vulnerability in the NVMe driver that allows an attacker to potentially exploit the system.", "Impact and Scope": "The vulnerability has a CVSS base score of 4.7 and an attack vector of LOCAL. The impact is HIGH, and the scope is UNCHANGED.", "Related MITRE ATT&CK Techniques": "The vulnerability is associated with MITRE ATT&CK techniques T1190, T1090, and T1003.", "Technical Details": "The vulnerability is caused by a race condition in the NVMe driver's handling of controller object references.", "Detection": "The vulnerability can be detected by monitoring system logs for suspicious activity related to the NVMe driver.", "Mitigation": "The vulnerability can be mitigated by ensuring that system configurations are up-to-date and applying the relevant patches.", "Conclusion": "The Linux kernel vulnerability CVE-2024-42152 is a serious vulnerability that requires prompt mitigation to prevent exploitation."}, "executive_analysis": {"Overview": "The Linux kernel vulnerability CVE-2024-42152 is a critical vulnerability that requires immediate attention.", "Business Impact": "The vulnerability has the potential to compromise sensitive data and disrupt business operations.", "Technical Impact": "The vulnerability could allow an attacker to gain unauthorized access to the system and potentially take control of the system.", "Mitigation Strategies": "Apply patches and ensure system configurations are up-to-date.", "Recommendations": "Promptly apply patches and updates to ensure system security.", "Conclusions": "The Linux kernel vulnerability CVE-2024-42152 is a critical vulnerability that requires immediate attention to prevent exploitation."}}