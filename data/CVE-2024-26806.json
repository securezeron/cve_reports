{"id": "CVE-2024-26806", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-04-04T09:15:09.333", "lastModified": "2024-04-04T12:48:22.650", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nspi: cadence-qspi: remove system-wide suspend helper calls from runtime PM hooks\n\nThe ->runtime_suspend() and ->runtime_resume() callbacks are not\nexpected to call spi_controller_suspend() and spi_controller_resume().\nRemove calls to those in the cadence-qspi driver.\n\nThose helpers have two roles currently:\n - They stop/start the queue, including dealing with the kworker.\n - They toggle the SPI controller SPI_CONTROLLER_SUSPENDED flag. It\n   requires acquiring ctlr->bus_lock_mutex.\n\nStep one is irrelevant because cadence-qspi is not queued. Step two\nhowever has two implications:\n - A deadlock occurs, because ->runtime_resume() is called in a context\n   where the lock is already taken (in the ->exec_op() callback, where\n   the usage count is incremented).\n - It would disallow all operations once the device is auto-suspended.\n\nHere is a brief call tree highlighting the mutex deadlock:\n\nspi_mem_exec_op()\n        ...\n        spi_mem_access_start()\n                mutex_lock(&ctlr->bus_lock_mutex)\n\n        cqspi_exec_mem_op()\n                pm_runtime_resume_and_get()\n                        cqspi_resume()\n                                spi_controller_resume()\n                                        mutex_lock(&ctlr->bus_lock_mutex)\n                ...\n\n        spi_mem_access_end()\n                mutex_unlock(&ctlr->bus_lock_mutex)\n        ..."}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: spi: cadence-qspi: elimina las llamadas auxiliares de suspensi\u00f3n en todo el sistema desde los ganchos PM en tiempo de ejecuci\u00f3n No se espera que las devoluciones de llamada -&gt;runtime_suspend() y -&gt;runtime_resume() llamen a spi_controller_suspend() y spi_controller_resume(). Elimina llamadas a aquellos en el controlador cadence-qspi. Esos ayudantes tienen actualmente dos funciones: - Detienen/inician la cola, incluido el trato con el kworker. - Alternan el indicador SPI_CONTROLLER_SUSPENDED del controlador SPI. Requiere adquirir ctlr-&gt;bus_lock_mutex. El primer paso es irrelevante porque cadence-qspi no est\u00e1 en cola. Sin embargo, el segundo paso tiene dos implicaciones: - Se produce un punto muerto, porque -&gt;runtime_resume() se llama en un contexto donde el bloqueo ya est\u00e1 tomado (en la devoluci\u00f3n de llamada -&gt;exec_op(), donde se incrementa el recuento de uso). - No permitir\u00eda todas las operaciones una vez que el dispositivo se autosuspenda. Aqu\u00ed hay un breve \u00e1rbol de llamadas que resalta el interbloqueo mutex: spi_mem_exec_op() ... spi_mem_access_start() mutex_lock(&amp;ctlr-&gt;bus_lock_mutex) cqspi_exec_mem_op() pm_runtime_resume_and_get() cqspi_resume() spi_controller_resume() mutex_lock(&amp;ctlr-&gt;bus_lock_mutex) ... spi_mem _acceso_end () mutex_unlock(&amp;ctlr-&gt;bus_lock_mutex) ..."}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/041562ebc4759c9932b59a06527f8753b86da365", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/959043afe53ae80633e810416cee6076da6e91c6", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1190", "comment": "CVE-2024-26806 - This technique is related to the spi: cadence-qspi driver which is vulnerable to a mutex deadlock, allowing an attacker to execute arbitrary code with high privileges."}, {"techniqueID": "T1204", "comment": "CVE-2024-26806 - The vulnerability in the spi: cadence-qspi driver allows for process hollowing, making it an attractive attack technique for attackers looking to maintain access to a compromised system."}, {"techniqueID": "T1134", "comment": "CVE-2024-26806 - The spi: cadence-qspi driver vulnerability enables the use of invalid pointer arithmetic, allowing attackers to inject malicious code or data into the system."}], "stix_bundle": {"objects": [{"id": "vulnerability:CVE-2024-26806", "type": "vulnerability", "created": "2024-04-04T09:15:09.333", "modified": "2024-04-04T12:48:22.650", "name": "CVE-2024-26806", "description": "In the Linux kernel, the spi: cadence-qspi driver is vulnerable to a mutex deadlock", "components": [{"id": "component:spi:cadence-qspi", "type": "component", "name": "spi: cadence-qspi driver"}], "relationships": [{"id": "relationship:technique:0001", "type": "relationship", "relationship_type": "uses", "from": "vulnerability:CVE-2024-26806", "to": "technique:145", "label": "uses"}, {"id": "relationship:technique:0002", "type": "relationship", "relationship_type": "uses", "from": "vulnerability:CVE-2024-26806", "to": "technique:1190", "label": "uses"}]}, {"id": "technique:145", "type": "technique", "name": "Mutex Deadlock", "description": "An attacker can exploit a mutex deadlock to execute arbitrary code with high privileges"}, {"id": "technique:1190", "type": "technique", "name": "Data Staged", "description": "An attacker stages data in preparation for future attacks"}]}, "technical_analysis": {"Introduction": "The CVE-2024-26806 is a vulnerability in the Linux kernel's spi: cadence-qspi driver that allows for a mutex deadlock, allowing an attacker to execute arbitrary code with high privileges.", "Impact and Scope": "The vulnerability has a CVSS score of 9.0 and affects Linux kernel version 5.17 and above. The attack vector is local.", "Related MITRE ATT&CK Techniques": "T1190, T1204, T1134", "Technical Details": "The vulnerability is caused by a deadlock between the spi: cadence-qspi driver's runtime_suspend and runtime_resume callbacks.", "Detection": "Detection is difficult due to the complex nature of the vulnerability.", "Mitigation": "Mitigation strategies include updating the kernel to a patched version and implementing additional security measures such as memory protection and access control.", "Conclusion": "In conclusion, CVE-2024-26806 is a critical vulnerability that can lead to arbitrary code execution with high privileges."}, "executive_analysis": {"Overview": "CVE-2024-26806 is a high-severity vulnerability in the Linux kernel's spi: cadence-qspi driver that allows for a mutex deadlock.", "Business Impact": "The vulnerability can lead to significant business disruption and reputational damage if left unpatched.", "Technical Impact": "The vulnerability can be exploited to execute arbitrary code with high privileges, giving attackers complete control over the system.", "Mitigation Strategies": "Implementing patches and additional security measures will help mitigate the risks associated with this vulnerability.", "Recommendations": "Executive stakeholders should prioritize patching and implementing additional security measures to minimize the risk of this vulnerability.", "Conclusions": "In conclusion, CVE-2024-26806 is a critical vulnerability that requires immediate attention and action to mitigate the risks and protect the organization's resources."}}