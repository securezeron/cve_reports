{"id": "CVE-2024-36977", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-06-18T20:15:13.517", "lastModified": "2024-06-20T12:44:01.637", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nusb: dwc3: Wait unconditionally after issuing EndXfer command\n\nCurrently all controller IP/revisions except DWC3_usb3 >= 310a\nwait 1ms unconditionally for ENDXFER completion when IOC is not\nset. This is because DWC_usb3 controller revisions >= 3.10a\nsupports GUCTL2[14: Rst_actbitlater] bit which allows polling\nCMDACT bit to know whether ENDXFER command is completed.\n\nConsider a case where an IN request was queued, and parallelly\nsoft_disconnect was called (due to ffs_epfile_release). This\neventually calls stop_active_transfer with IOC cleared, hence\nsend_gadget_ep_cmd() skips waiting for CMDACT cleared during\nEndXfer. For DWC3 controllers with revisions >= 310a, we don't\nforcefully wait for 1ms either, and we proceed by unmapping the\nrequests. If ENDXFER didn't complete by this time, it leads to\nSMMU faults since the controller would still be accessing those\nrequests.\n\nFix this by ensuring ENDXFER completion by adding 1ms delay in\n__dwc3_stop_active_transfer() unconditionally."}, {"lang": "es", "value": "En el kernel de Linux, se resolvi\u00f3 la siguiente vulnerabilidad: usb: dwc3: Espere incondicionalmente despu\u00e9s de emitir el comando EndXfer Actualmente, todas las IP/revisiones del controlador excepto DWC3_usb3 &gt;= 310a esperan 1 ms incondicionalmente para que ENDXFER se complete cuando el IOC no est\u00e1 configurado. Esto se debe a que las revisiones del controlador DWC_usb3 &gt;= 3.10a admiten el bit GUCTL2[14: Rst_actbitlater] que permite sondear el bit CMDACT para saber si se complet\u00f3 el comando ENDXFER. Considere un caso en el que se puso en cola una solicitud IN y, en paralelo, se llam\u00f3 a soft_disconnect (debido a ffs_epfile_release). Esto eventualmente llama a stop_active_transfer con el IOC borrado, por lo tanto, send_gadget_ep_cmd() omite la espera de que CMDACT se borre durante EndXfer. Para los controladores DWC3 con revisiones &gt;= 310a, tampoco esperamos forzosamente 1 ms y procedemos a desasignar las solicitudes. Si ENDXFER no se complet\u00f3 en este momento, se producir\u00e1n fallas de SMMU ya que el controlador a\u00fan estar\u00eda accediendo a esas solicitudes. Solucione este problema asegurando la finalizaci\u00f3n de ENDXFER agregando un retraso de 1 ms en __dwc3_stop_active_transfer() incondicionalmente."}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/1ba145f05b5c8f0b1a947a0633b5edff5dd1f1c5", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/1d26ba0944d398f88aaf997bda3544646cf21945", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/341eb08dbca9eae05308c442fbfab1813a44c97a", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/4a387e032909c6dc2b479452c5bbe9a252057925", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/ec96bcf5f96a7a5c556b0e881ac3e5c3924d542c", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1059: Command and Control", "comment": "The vulnerability in the Linux kernel's USB driver allows for command and control operations, making it possible for an attacker to execute arbitrary code on the targeted system."}, {"techniqueID": "T1190: Exploitation of Remote Services", "comment": "The vulnerable USB driver allows an attacker to exploit remote services, making it possible to execute remote code execution attacks."}, {"techniqueID": "T1499: Disrupted System Functionality", "comment": "The vulnerability can be used to disrupt system functionality by allowing an attacker to manipulate system resources, making it possible to crash or freeze the system."}], "stix_bundle": {"bundle": {"name": "Linux Kernel USB Driver Vulnerability", "created_by_ref": {"type": "stix_core:Identity", "value": "MITRE"}, "modified": "2024-06-20T12:44:01.637", "created": "2024-06-18T20:15:13.517", "description": "Vulnerability in the Linux kernel's USB driver", "related_node": [{"type": "stix_core:Vulnerability", "id": "CVE-2024-36977"}], "objects": {"Vulnerability": {"id": "CVE-2024-36977", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nusb: dwc3: Wait unconditionally after issuing EndXfer command"}}}}, "technical_analysis": {"Introduction": "The Linux kernel's USB driver contains a vulnerability that can be exploited by an attacker to execute arbitrary code on the targeted system.", "Impact and Scope": "The vulnerability affects all Linux systems that use the USB driver and can be exploited by an attacker to execute remote code execution attacks.", "Related MITRE ATT&CK Techniques": "The vulnerability is relevant to several MITRE ATT&CK techniques, including T1059, T1190, and T1499.", "Technical Details": "The vulnerability occurs when an attacker sends a malicious USB request to a Linux system, which can be exploited to execute arbitrary code on the system.", "Detection": "Detection of the vulnerability can be performed by monitoring system logs for suspicious USB activity and analyzing system memory for malicious code execution.", "Mitigation": "Mitigation strategies include applying updates to the Linux kernel, enabling system logs to detect suspicious USB activity, and implementing memory protection mechanisms.", "Conclusion": "The vulnerability in the Linux kernel's USB driver is a critical security risk that can be exploited by an attacker to execute remote code execution attacks."}, "executive_analysis": {"Overview": "The Linux kernel's USB driver contains a vulnerability that can be exploited by an attacker to execute remote code execution attacks.", "Business Impact": "The vulnerability can result in significant financial losses and damage to an organization's reputation.", "Technical Impact": "The vulnerability affects all Linux systems that use the USB driver and can be exploited to execute remote code execution attacks.", "Mitigation Strategies": "Applying updates to the Linux kernel, enabling system logs to detect suspicious USB activity, and implementing memory protection mechanisms can help mitigate the vulnerability.", "Recommendations": "Executives should prioritize patching and updating their Linux systems, monitoring system logs for suspicious USB activity, and implementing memory protection mechanisms to help mitigate the vulnerability.", "Conclusions": "The vulnerability in the Linux kernel's USB driver is a critical security risk that requires immediate attention and action."}}