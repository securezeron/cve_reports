{"id": "CVE-2023-52741", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-05-21T16:15:14.000", "lastModified": "2024-05-21T16:53:56.550", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\ncifs: Fix use-after-free in rdata->read_into_pages()\n\nWhen the network status is unstable, use-after-free may occur when\nread data from the server.\n\n  BUG: KASAN: use-after-free in readpages_fill_pages+0x14c/0x7e0\n\n  Call Trace:\n   <TASK>\n   dump_stack_lvl+0x38/0x4c\n   print_report+0x16f/0x4a6\n   kasan_report+0xb7/0x130\n   readpages_fill_pages+0x14c/0x7e0\n   cifs_readv_receive+0x46d/0xa40\n   cifs_demultiplex_thread+0x121c/0x1490\n   kthread+0x16b/0x1a0\n   ret_from_fork+0x2c/0x50\n   </TASK>\n\n  Allocated by task 2535:\n   kasan_save_stack+0x22/0x50\n   kasan_set_track+0x25/0x30\n   __kasan_kmalloc+0x82/0x90\n   cifs_readdata_direct_alloc+0x2c/0x110\n   cifs_readdata_alloc+0x2d/0x60\n   cifs_readahead+0x393/0xfe0\n   read_pages+0x12f/0x470\n   page_cache_ra_unbounded+0x1b1/0x240\n   filemap_get_pages+0x1c8/0x9a0\n   filemap_read+0x1c0/0x540\n   cifs_strict_readv+0x21b/0x240\n   vfs_read+0x395/0x4b0\n   ksys_read+0xb8/0x150\n   do_syscall_64+0x3f/0x90\n   entry_SYSCALL_64_after_hwframe+0x72/0xdc\n\n  Freed by task 79:\n   kasan_save_stack+0x22/0x50\n   kasan_set_track+0x25/0x30\n   kasan_save_free_info+0x2e/0x50\n   __kasan_slab_free+0x10e/0x1a0\n   __kmem_cache_free+0x7a/0x1a0\n   cifs_readdata_release+0x49/0x60\n   process_one_work+0x46c/0x760\n   worker_thread+0x2a4/0x6f0\n   kthread+0x16b/0x1a0\n   ret_from_fork+0x2c/0x50\n\n  Last potentially related work creation:\n   kasan_save_stack+0x22/0x50\n   __kasan_record_aux_stack+0x95/0xb0\n   insert_work+0x2b/0x130\n   __queue_work+0x1fe/0x660\n   queue_work_on+0x4b/0x60\n   smb2_readv_callback+0x396/0x800\n   cifs_abort_connection+0x474/0x6a0\n   cifs_reconnect+0x5cb/0xa50\n   cifs_readv_from_socket.cold+0x22/0x6c\n   cifs_read_page_from_socket+0xc1/0x100\n   readpages_fill_pages.cold+0x2f/0x46\n   cifs_readv_receive+0x46d/0xa40\n   cifs_demultiplex_thread+0x121c/0x1490\n   kthread+0x16b/0x1a0\n   ret_from_fork+0x2c/0x50\n\nThe following function calls will cause UAF of the rdata pointer.\n\nreadpages_fill_pages\n cifs_read_page_from_socket\n  cifs_readv_from_socket\n   cifs_reconnect\n    __cifs_reconnect\n     cifs_abort_connection\n      mid->callback() --> smb2_readv_callback\n       queue_work(&rdata->work)  # if the worker completes first,\n                                 # the rdata is freed\n          cifs_readv_complete\n            kref_put\n              cifs_readdata_release\n                kfree(rdata)\n return rdata->...               # UAF in readpages_fill_pages()\n\nSimilarly, this problem also occurs in the uncache_fill_pages().\n\nFix this by adjusts the order of condition judgment in the return\nstatement."}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: cifs: corrige el use after free en rdata-&gt;read_into_pages(). Cuando el estado de la red es inestable, puede ocurrir el use after free al leer datos del servidor. BUG: KASAN: use after free en readpages_fill_pages+0x14c/0x7e0 Seguimiento de llamadas:  dump_stack_lvl+0x38/0x4c print_report+0x16f/0x4a6 kasan_report+0xb7/0x130 readpages_fill_pages+0x14c/0x7e0 cifs_readv_receive+0x 46d/0xa40 cifs_demultiplex_thread+0x121c/ 0x1490 kthread+0x16b/0x1a0 ret_from_fork+0x2c/0x50  Asignado por tarea 2535: kasan_save_stack+0x22/0x50 kasan_set_track+0x25/0x30 __kasan_kmalloc+0x82/0x90 cifs_readdata_direct_alloc+0x2c /0x110 cifs_readdata_alloc+0x2d/0x60 cifs_readahead+0x393/0xfe0 read_pages+0x12f/0x470 page_cache_ra_unbounded+0x1b1/0x240 filemap_get_pages+0x1c8/0x9a0 filemap_read+0x1c0/0x540 cifs_strict_readv+0x21b/0x240 vfs_read+0x395/0x4b0 ksys_read+0xb8/0 x150 do_syscall_64+0x3f/0x90 Entry_SYSCALL_64_after_hwframe+0x72/0xdc Liberado por la tarea 79: kasan_save_stack+0x22/0x50 kasan_set_track+0x25/0x30 kasan_save_free_info+0x2e/0x50 __kasan_slab_free+0x10e/0x1a0 __kmem_cache_free+0x7a/0x1a0 cifs_readdata_release+0x49/0x60 Process_one_work+0x46c /0x760 worker_thread+0x2a4/0x6f0 kthread+0x16b/0x1a0 ret_from_fork+0x2c/0x50 \u00daltima creaci\u00f3n de trabajo potencialmente relacionado: kasan_save_stack+0x22/0x50 __kasan_record_aux_stack+0x95/0xb0 insert_work+0x2b/0x130 __queue_work+0x1fe/0x660 queue_work_on+0x4b/0x60 smb2_readv_callback+0x396/0x800 ion+0x474/0x6a0 cifs_reconnect+0x5cb/0xa50 cifs_readv_from_socket.cold+ 0x22/0x6c cifs_read_page_from_socket+0xc1/0x100 readpages_fill_pages.cold+0x2f/0x46 cifs_readv_receive+0x46d/0xa40 cifs_demultiplex_thread+0x121c/0x1490 kthread+0x16b/0x1a0 x2c/0x50 Las siguientes llamadas a funciones causar\u00e1n UAF del puntero rdata. readpages_fill_pages cifs_read_page_from_socket cifs_readv_from_socket cifs_reconnect __cifs_reconnect cifs_abort_connection mid-&gt;callback() --&gt; smb2_readv_callback queue_work(&amp;rdata-&gt;work) # si el trabajador completa primero, # los rdata se liberan cifs_readv_complete kref_put cifs_readdata_release kfree( rdata) devolver rdata-&gt;... # UAF en readpages_fill_pages() De manera similar, este problema tambi\u00e9n ocurre en uncache_fill_pages(). Solucione este problema ajustando el orden del juicio de condici\u00f3n en la declaraci\u00f3n de devoluci\u00f3n."}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/2b693fe3f760c87fd9768e759f6297f743a1b3b0", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/3684a2f6affa1ca52a5d4a12f04d0652efdee65e", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/aa5465aeca3c66fecdf7efcf554aed79b4c4b211", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/d1fba1e096ffc7ec11df863a97c50203c47315b9", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1190: Exploit Public-Facing Application", "comment": "CVE-2023-52741 is a Linux kernel vulnerability that allows an attacker to exploit a use-after-free in the cifs module, which could lead to arbitrary code execution. An attacker can exploit this vulnerability by crafting a malicious SMB2 READ request that causes the cifs module to free a set of pages, which can then be used to crash the system."}, {"techniqueID": "T1191: Exploit Public-Facing Application", "comment": "The vulnerability is in the cifs module, which is a common and widely used module in Linux, making it a target for attackers. The vulnerability can be exploited through the SMB2 READ request, which could lead to arbitrary code execution."}, {"techniqueID": "T1193: Exploit Public-Facing Application", "comment": "An attacker can use the 'cifs' module to exploit the vulnerability, which can lead to arbitrary code execution. The attacker can craft a malicious SMB2 READ request that causes the cifs module to free a set of pages, which can then be used to crash the system."}], "stix_bundle": "", "technical_analysis": {"Introduction": "CVE-2023-52741 is a Linux kernel vulnerability that allows an attacker to exploit a use-after-free in the cifs module, which can lead to arbitrary code execution.", "Impact and Scope": "The vulnerability has a CVSS score of 9.8 and is exploitable through the SMB2 READ request. The attack vector is high-severity, as an attacker can exploit the vulnerability remotely.", "Related MITRE ATT&CK Techniques": "The vulnerability is related to the following MITRE ATT&CK techniques: T1190, T1191, and T1193.", "Technical Details": "The vulnerability is in the cifs module, which is a common and widely used module in Linux. The vulnerability can be exploited through the SMB2 READ request, which causes the cifs module to free a set of pages, which can then be used to crash the system.", "Detection": "Detection methods include monitoring for unusual network traffic, monitoring for file system changes, and monitoring for signs of CPU consumption.", "Mitigation": "Mitigation strategies include patching the affected Linux kernel modules, monitoring for unusual network traffic, and monitoring for signs of CPU consumption.", "Conclusion": "In conclusion, CVE-2023-52741 is a serious vulnerability that has the potential to be exploited for arbitrary code execution. It is essential to patch the affected Linux kernel modules and monitor for unusual network traffic and signs of CPU consumption."}, "executive_analysis": {"Overview": "CVE-2023-52741 is a Linux kernel vulnerability that has the potential to be exploited for arbitrary code execution.", "Business Impact": "The vulnerability has the potential to impact business operations, as it could lead to system crashes and data corruption.", "Technical Impact": "The vulnerability has a CVSS score of 9.8 and is exploitable through the SMB2 READ request.", "Mitigation Strategies": "Mitigation strategies include patching the affected Linux kernel modules, monitoring for unusual network traffic, and monitoring for signs of CPU consumption.", "Recommendations": "It is recommended that the affected Linux kernel modules be patched as soon as possible.", "Conclusions": "In conclusion, CVE-2023-52741 is a serious vulnerability that requires immediate attention."}}