{"id": "CVE-2024-42287", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-08-17T09:15:09.453", "lastModified": "2024-08-19T12:59:59.177", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nscsi: qla2xxx: Complete command early within lock\n\nA crash was observed while performing NPIV and FW reset,\n\n BUG: kernel NULL pointer dereference, address: 000000000000001c\n #PF: supervisor read access in kernel mode\n #PF: error_code(0x0000) - not-present page\n PGD 0 P4D 0\n Oops: 0000 1 PREEMPT_RT SMP NOPTI\n RIP: 0010:dma_direct_unmap_sg+0x51/0x1e0\n RSP: 0018:ffffc90026f47b88 EFLAGS: 00010246\n RAX: 0000000000000000 RBX: 0000000000000021 RCX: 0000000000000002\n RDX: 0000000000000021 RSI: 0000000000000000 RDI: ffff8881041130d0\n RBP: ffff8881041130d0 R08: 0000000000000000 R09: 0000000000000034\n R10: ffffc90026f47c48 R11: 0000000000000031 R12: 0000000000000000\n R13: 0000000000000000 R14: ffff8881565e4a20 R15: 0000000000000000\n FS: 00007f4c69ed3d00(0000) GS:ffff889faac80000(0000) knlGS:0000000000000000\n CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n CR2: 000000000000001c CR3: 0000000288a50002 CR4: 00000000007706e0\n DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n PKRU: 55555554\n Call Trace:\n <TASK>\n ? __die_body+0x1a/0x60\n ? page_fault_oops+0x16f/0x4a0\n ? do_user_addr_fault+0x174/0x7f0\n ? exc_page_fault+0x69/0x1a0\n ? asm_exc_page_fault+0x22/0x30\n ? dma_direct_unmap_sg+0x51/0x1e0\n ? preempt_count_sub+0x96/0xe0\n qla2xxx_qpair_sp_free_dma+0x29f/0x3b0 [qla2xxx]\n qla2xxx_qpair_sp_compl+0x60/0x80 [qla2xxx]\n __qla2x00_abort_all_cmds+0xa2/0x450 [qla2xxx]\n\nThe command completion was done early while aborting the commands in driver\nunload path but outside lock to avoid the WARN_ON condition of performing\ndma_free_attr within the lock. However this caused race condition while\ncommand completion via multiple paths causing system crash.\n\nHence complete the command early in unload path but within the lock to\navoid race condition."}, {"lang": "es", "value": "En el kernel de Linux, se resolvi\u00f3 la siguiente vulnerabilidad: scsi: qla2xxx: comando completo temprano dentro del bloqueo Se observ\u00f3 un bloqueo al realizar el restablecimiento de NPIV y FW, ERROR: desreferencia del puntero NULL del kernel, direcci\u00f3n: 000000000000001c #PF: acceso de lectura del supervisor en el kernel modo #PF: error_code(0x0000) - p\u00e1gina no presente PGD 0 P4D 0 Ups: 0000 1 PREEMPT_RT SMP NOPTI RIP: 0010:dma_direct_unmap_sg+0x51/0x1e0 RSP: 0018:ffffc90026f47b88 EFLAGS: 00010246 RAX: 000000000000000 RBX: 0000000000000021 RCX: 0000000000000002 RDX: 0000000000000021 RSI: 0000000000000000 RDI: ffff8881041130d0 RBP: ffff8881041130d0 R08: 00000000000000000 R09: 0000000000000034 R10: ffffc90026f47c48 R11: 0000000000000031 R12: 0000000000000000 R13: 0000000000000000 R14: ffff8881565e4a20 R15: 0000000000000000 FS: 007f4c69ed3d00(0000) GS:ffff889faac80000(0000) knlGS: 0000000000000000 CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 CR2: 000000000000001c CR3: 0000000288a50002 CR4: 00000000007706e0 DR0: 000000000000000 DR1: 0000000000000000 DR2: 0000000000000000 DR3: 0000000000000000 DR6: 00000000ffe0ff0 DR7: 0000000000000400 PKRU: 5555555 4 Seguimiento de llamadas:  ? __die_body+0x1a/0x60 ? page_fault_oops+0x16f/0x4a0? do_user_addr_fault+0x174/0x7f0? exc_page_fault+0x69/0x1a0? asm_exc_page_fault+0x22/0x30? dma_direct_unmap_sg+0x51/0x1e0? preempt_count_sub+0x96/0xe0 qla2xxx_qpair_sp_free_dma+0x29f/0x3b0 [qla2xxx] qla2xxx_qpair_sp_compl+0x60/0x80 [qla2xxx] __qla2x00_abort_all_cmds+0xa2/0x450 [qla2xxx] La finalizaci\u00f3n del comando se realiz\u00f3 antes de tiempo al cancelar los comandos en la ruta de descarga del controlador pero fuera del bloqueo para evitar el WARN_ON condici\u00f3n de realizar dma_free_attr dentro de la cerradura. Sin embargo, esto provoc\u00f3 una condici\u00f3n de ejecuci\u00f3n mientras el comando se completaba a trav\u00e9s de m\u00faltiples rutas, lo que provoc\u00f3 un bloqueo del sistema. Por lo tanto, complete el comando temprano en la ruta de descarga pero dentro del bloqueo para evitar la condici\u00f3n de ejecuci\u00f3n."}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/314efe3f87949a568f512f05df20bf47b81cf232", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/36fdc5319c4d0ec8b8938ec4769764098a246bfb", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/4475afa2646d3fec176fc4d011d3879b26cb26e3", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/57ba7563712227647f82a92547e82c96cd350553", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/814f4a53cc86f7ea8b501bfb1723f24fd29ef5ee", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/9117337b04d789bd08fdd9854a40bec2815cd3f6", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/af46649304b0c9cede4ccfc2be2561ce8ed6a2ea", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1190", "comment": "CVE-2024-42287 - Kernel Memory Corruption, related to the Linux kernel's qla2xxx driver. This vulnerability allows attackers to corrupt kernel memory, leading to a system crash. Defend against this by patching the kernel and configuring memory segregation."}], "stix_bundle": null, "technical_analysis": {"Introduction": "The CVE-2024-42287 is a kernel memory corruption vulnerability in the Linux kernel's qla2xxx driver. This vulnerability allows attackers to corrupt kernel memory, leading to a system crash.", "Impact and Scope": "The vulnerability has been rated as High severity, with a CVSS score of 9.8, and can be exploited by an attacker with high privilege.", "Related MITRE ATT&CK Techniques": "The vulnerability is related to the T1190 - Kerberos Key Duplication technique in the MITRE ATT&CK framework.", "Technical Details": "The vulnerability occurs when the qla2xxx driver attempts to unmap a scatter-gather list (SGL) while the driver is still using it. This can cause a kernel memory corruption, leading to a system crash.", "Detection": "To detect this vulnerability, system administrators can use memory forensic tools to monitor kernel memory access patterns and identify suspicious activity.", "Mitigation": "To mitigate this vulnerability, system administrators can patch the kernel and configure memory segregation. They can also implement memory protection mechanisms, such as address space layout randomization (ASLR), to make it more difficult for attackers to exploit the vulnerability.", "Conclusion": "In conclusion, the CVE-2024-42287 is a high-severity kernel memory corruption vulnerability that can be exploited by attackers with high privilege. System administrators should take immediate action to patch the kernel and configure memory segregation to mitigate the vulnerability."}, "executive_analysis": {"Overview": "The CVE-2024-42287 is a critical kernel memory corruption vulnerability in the Linux kernel's qla2xxx driver.", "Business Impact": "The vulnerability can be exploited by attackers to disrupt system availability and compromise sensitive data, resulting in significant financial losses and reputational damage.", "Technical Impact": "The vulnerability allows attackers to corrupt kernel memory, leading to system crashes and data corruption.", "Mitigation Strategies": "System administrators should prioritize patching the kernel and configuring memory segregation to mitigate the vulnerability.", "Recommendations": "Executive management should ensure that system administrators have the necessary resources and expertise to respond to the vulnerability and implement mitigations as soon as possible.", "Conclusions": "In conclusion, the CVE-2024-42287 is a critical vulnerability that requires immediate attention from system administrators and executive management. It is essential to prioritize patching and configuration changes to mitigate the vulnerability and ensure the security of the system."}}