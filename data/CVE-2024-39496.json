{"id": "CVE-2024-39496", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-07-12T13:15:12.253", "lastModified": "2024-07-24T19:02:36.660", "vulnStatus": "Analyzed", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: zoned: fix use-after-free due to race with dev replace\n\nWhile loading a zone's info during creation of a block group, we can race\nwith a device replace operation and then trigger a use-after-free on the\ndevice that was just replaced (source device of the replace operation).\n\nThis happens because at btrfs_load_zone_info() we extract a device from\nthe chunk map into a local variable and then use the device while not\nunder the protection of the device replace rwsem. So if there's a device\nreplace operation happening when we extract the device and that device\nis the source of the replace operation, we will trigger a use-after-free\nif before we finish using the device the replace operation finishes and\nfrees the device.\n\nFix this by enlarging the critical section under the protection of the\ndevice replace rwsem so that all uses of the device are done inside the\ncritical section."}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: btrfs:zoned: corrige el use-after-free debido a la ejecuci\u00f3n con el reemplazo de desarrollo. Mientras cargamos la informaci\u00f3n de una zona durante la creaci\u00f3n de un grupo de bloques, podemos ejecutar una operaci\u00f3n de reemplazo de dispositivo y luego activar un use-after-free en el dispositivo que acaba de ser reemplazado (dispositivo fuente de la operaci\u00f3n de reemplazo). Esto sucede porque en btrfs_load_zone_info() extraemos un dispositivo del mapa de fragmentos en una variable local y luego usamos el dispositivo mientras no est\u00e1 bajo la protecci\u00f3n del dispositivo y reemplazamos rwsem. Entonces, si se produce una operaci\u00f3n de reemplazo de dispositivo cuando extraemos el dispositivo y ese dispositivo es la fuente de la operaci\u00f3n de reemplazo, activaremos un use-after-free si antes de terminar de usar el dispositivo la operaci\u00f3n de reemplazo finaliza y libera el dispositivo. Solucione este problema ampliando la secci\u00f3n cr\u00edtica bajo la protecci\u00f3n del dispositivo y reemplace rwsem para que todos los usos del dispositivo se realicen dentro de la secci\u00f3n cr\u00edtica."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.8, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-416"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionEndExcluding": "6.1.95", "matchCriteriaId": "19A7A2F1-5F51-4897-8BF3-5079D28CBE9C"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.2", "versionEndExcluding": "6.6.35", "matchCriteriaId": "6F019D15-84C0-416B-8C57-7F51B68992F0"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.7", "versionEndExcluding": "6.9.6", "matchCriteriaId": "0ABBBA1D-F79D-4BDB-AA41-D1EDCC4A6975"}]}]}], "references": [{"url": "https://git.kernel.org/stable/c/0090d6e1b210551e63cf43958dc7a1ec942cdde9", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/092571ef9a812566c8f2c9038d9c2a64c49788d6", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/17765964703b88d8befd899f8501150bb7e07e43", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/a0cc006f4214b87e70983c692e05bb36c59b5752", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}], "techniques": [{"techniqueID": "T1222", "comment": "CVE-2024-39496 - The exploitation of use-after-free vulnerability in the Linux kernel's btrfs module allows for local privilege escalation. This technique is relevant as it highlights the importance of memory management and data corruption in the kernel."}, {"techniqueID": "T1190", "comment": "CVE-2024-39496 - The exploitation of use-after-free vulnerability in the Linux kernel's btrfs module allows for local privilege escalation. This technique is relevant as it highlights the importance of kernel-level attacks and the potential for exploitation of kernel vulnerabilities."}, {"techniqueID": "T1049", "comment": "CVE-2024-39496 - The exploitation of use-after-free vulnerability in the Linux kernel's btrfs module allows for local privilege escalation. This technique is relevant as it highlights the importance of kernel-level attacks and the potential for exploitation of kernel vulnerabilities."}], "stix_bundle": {"type": "bundle", "id": "CVE-2024-39496-Bundle", "created_by_ref": " actor: analysts", "created": "2024-07-24T14:15:12.253Z", "modified": "2024-07-24T19:02:36.660Z", "objects": [{"type": "vulnerability", "id": "CVE-2024-39496", "name": "CVE-2024-39496 - Linux kernel btrfs use-after-free vulnerability", "description": " CVE-2024-39496: In the Linux kernel, the following vulnerability has been resolved: btrfs: zoned: fix use-after-free due to race with dev replace.", " Exploitability ": "Low", "Risk ": "High", "Impact": "Privileges Escalation"}, {"type": "indicator", "id": "Indicator-1", "name": "Indicator: CVE-2024-39496 - Local Privilege Escalation", "description": "Local Privilege Escalation using CVE-2024-39496", " observable": ["Linux kernel btrfs use-after-free vulnerability"]}, {"type": "tactics", "id": "Tactics-1", "name": "Tactics: CVE-2024-39496", "description": "Tactics used to exploit CVE-2024-39496 - Local Privilege Escalation", "techniques": ["T1222", "T1190", "T1049"]}, {"type": "controls", "id": "Controls-1", "name": "Controls: Defending against CVE-2024-39496", "description": "Controls to prevent exploitation of CVE-2024-39496", "notes": ["Apply patches from 6.1.95", "Disable btrfs support", "Monitor for suspicious activity"]}], "relationships": [{"type": "is_involved_in", "idref": "Indicator-1", "object": {"type": "vulnerability", "id": "CVE-2024-39496"}}, {"type": "is_involved_in", "idref": "Tactics-1", "object": {"type": "vulnerability", "id": "CVE-2024-39496"}}, {"type": "is_involved_in", "idref": "Indicator-1", "object": {"type": "tactics", "id": "Tactics-1"}}]}, "technical_analysis": {"Introduction": "The Linux kernel's btrfs module is vulnerable to a use-after-free vulnerability, allowing local privilege escalation.", "Impact and Scope": "The vulnerability affects Linux kernel versions 6.1.95, 6.2 to 6.6.35, and 6.7 to 6.9.6.", "Related MITRE ATT&CK Techniques": "T1222: Exploitation of use-after-free vulnerability in the Linux kernel's btrfs module.", "Technical Details": "The vulnerability occurs when the btrfs module is loaded and the race condition between the device replace operation and the loading of the zone's info.", "Detection": "Monitor for suspicious activity related to the btrfs module.", "Mitigation": "Apply patches from 6.1.95, disable btrfs support, and monitor for suspicious activity.", "Conclusion": "The vulnerability highlights the importance of memory management and data corruption in the kernel."}, "executive_analysis": {"Overview": "The Linux kernel's btrfs module is vulnerable to a use-after-free vulnerability, allowing local privilege escalation.", "Business Impact": "The vulnerability has significant business implications as it allows for local privilege escalation.", "Technical Impact": "The vulnerability affects the integrity of the Linux kernel and can lead to unauthorized access.", "Mitigation Strategies": "Apply patches from 6.1.95, disable btrfs support, and monitor for suspicious activity.", "Recommendations": "Patches should be applied promptly, and the vulnerability should be tracked and monitored.", "Conclusions": "The vulnerability highlights the importance of kernel-level security and the need for regular patching and monitoring."}}