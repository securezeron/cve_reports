{"id": "CVE-2024-39691", "sourceIdentifier": "security-advisories@github.com", "published": "2024-07-05T19:15:10.460", "lastModified": "2024-07-08T15:49:22.437", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "matrix-appservice-irc is a Node.js IRC bridge for the Matrix messaging protocol. The fix for GHSA-wm4w-7h2q-3pf7 / CVE-2024-32000 included in matrix-appservice-irc 2.0.0 relied on the Matrix homeserver-provided timestamp to determine whether a user has access to the event they're replying to when determining whether or not to include a truncated version of the original event in the IRC message. Since this value is controlled by external entities, a malicious Matrix homeserver joined to a room in which a matrix-appservice-irc bridge instance (before version 2.0.1) is present can fabricate the timestamp with the intent of tricking the bridge into leaking room messages the homeserver should not have access to. matrix-appservice-irc 2.0.1 drops the reliance on `origin_server_ts` when determining whether or not an event should be visible to a user, instead tracking the event timestamps internally. As a workaround, it's possible to limit the amount of information leaked by setting a reply template that doesn't contain the original message."}, {"lang": "es", "value": "Matrix-appservice-irc es un puente IRC de Node.js para el protocolo de mensajer\u00eda Matrix. La soluci\u00f3n para GHSA-wm4w-7h2q-3pf7/CVE-2024-32000 incluida en Matrix-appservice-irc 2.0.0 se basaba en la marca de tiempo proporcionada por el servidor dom\u00e9stico de Matrix para determinar si un usuario tiene acceso al evento al que est\u00e1 respondiendo cuando determina si se incluye o no una versi\u00f3n truncada del evento original en el mensaje IRC. Dado que este valor est\u00e1 controlado por entidades externas, un servidor dom\u00e9stico Matrix malicioso unido a una sala en la que est\u00e1 presente una instancia de puente Matrix-appservice-irc (anterior a la versi\u00f3n 2.0.1) puede fabricar la marca de tiempo con la intenci\u00f3n de enga\u00f1ar al puente para fugar mensajes de la sala, mensajes a los que el servidor dom\u00e9stico no deber\u00eda tener acceso. Matrix-appservice-irc 2.0.1 elimina la dependencia de `origin_server_ts` al determinar si un evento debe ser visible o no para un usuario, en lugar de realizar un seguimiento interno de las marcas de tiempo del evento. Como soluci\u00f3n alternativa, es posible limitar la cantidad de informaci\u00f3n filtrada configurando una plantilla de respuesta que no contenga el mensaje original."}], "metrics": {"cvssMetricV31": [{"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-280"}, {"lang": "en", "value": "CWE-755"}]}], "references": [{"url": "https://github.com/matrix-org/matrix-appservice-irc/blob/d5d67d1d3ea3f0f6962a0af2cc57b56af3ad2129/config.sample.yaml#L601-L604", "source": "security-advisories@github.com"}, {"url": "https://github.com/matrix-org/matrix-appservice-irc/commit/1835e047f269001054be4c68867797aa12372a0f", "source": "security-advisories@github.com"}, {"url": "https://github.com/matrix-org/matrix-appservice-irc/pull/1804", "source": "security-advisories@github.com"}, {"url": "https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-w9mh-5x8j-9754", "source": "security-advisories@github.com"}], "techniques": [{"techniqueID": "T1140", "comment": "CVE-2024-39691 - CWE-280, CWE-755 - This vulnerability allows an attacker to fabricate a timestamp and trick the bridge into leaking room messages, demonstrating the importance of proper timestamp verification and control in Matrix IRC bridges."}, {"techniqueID": "T1021", "comment": "CVE-2024-39691 - CWE-280, CWE-755 - This vulnerability showcases the importance of secure configuration management, as the patch introduced in matrix-appservice-irc 2.0.1 drops reliance on external timestamp control, highlighting the need for careful configuration review and validation."}, {"techniqueID": "T1190", "comment": "CVE-2024-39691 - CWE-280, CWE-755 - This vulnerability demonstrates the potential for lateral movement and privilege escalation in Matrix IRC environments, underscoring the importance of robust authentication, authorization, and auditing mechanisms."}], "stix_bundle": {"objects": [{"id": "https://example.com/stix-bundle/CVE-2024-39691", "type": "indicator", "created_by_ref": "https://example.com/stix-bundle/author", "modified": "2024-07-08T15:49:22.437", "name": "CVE-2024-39691", "description": "Matrix-appservice-irc 2.0.0 relying on Matrix homeserver-provided timestamp to determine whether a user has access to the event they're replying to", "created": "2024-07-05T19:15:10.460", "modified_by_ref": "https://example.com/stix-bundle/author", "objectMarking": {"type": "Marker", "id": "https://example.com/stix-bundle/marker/CVE-2024-39691"}, "Relationships": [{"id": "https://example.com/stix-bundle/relationship/CVE-2024-39691/mitre-tactic", "type": "Observation", "from": "https://example.com/stix-bundle/CVE-2024-39691", "to": "https://example.com/stix-bundle/mitre-tactic/T1140", "relationship_type": "mitre-tactic"}, {"id": "https://example.com/stix-bundle/relationship/CVE-2024-39691/mitre-tech", "type": "Observation", "from": "https://example.com/stix-bundle/CVE-2024-39691", "to": "https://example.com/stix-bundle/mitre-tech/T1021", "relationship_type": "mitre-tech"}]}, {"id": "https://example.com/stix-bundle/mitre-tactic/T1140", "type": "mitre-tactic", "name": "TSN-COMMAND-SERVER", "description": "Use system and network capabilities in the command shell to execute commands and write to system files", "url": "https://attack.mitre.org/techniques/T1140/"}, {"id": "https://example.com/stix-bundle/mitre-tech/T1021", "type": "mitre-tech", "name": "DEV-CODE-FACTORING", "description": "Implement code review and validation controls", "url": "https://attack.mitre.org/techniques/T1021/"}, {"id": "https://example.com/stix-bundle/author", "type": "author", "name": "Your Name"}], "relationship": [{"id": "https://example.com/stix-bundle/relationship/CVE-2024-39691/views", "type": "Relationship", "from": "https://example.com/stix-bundle/CVE-2024-39691", "to": "https://example.com/stix-bundle/author", "relationship_type": "views"}]}, "technical_analysis": {"Introduction": "CVE-2024-39691 is a vulnerability in the matrix-appservice-irc 2.0.0 that allows an attacker to fabricate a timestamp and trick the bridge into leaking room messages.", "Impact and Scope": "This vulnerability has a CVSS score of 4.3 and affects Matrix IRC bridges before version 2.0.1, potentially leading to unauthorized access to room messages.", "Related MITRE ATT&CK Techniques": "T1140, T1021", "Technical Details": "The vulnerability relies on the Matrix homeserver-provided timestamp to determine whether a user has access to the event they're replying to, which can be controlled by external entities.", "Detection": "Detection may involve monitoring for suspicious timestamp modifications and reviewing system logs for evidence of unauthorized access.", "Mitigation": "Mitigation involves dropping reliance on external timestamp control and implementing robust authentication, authorization, and auditing mechanisms.", "Conclusion": "CVE-2024-39691 highlights the importance of secure configuration management, robust authentication, and auditing mechanisms in Matrix IRC environments."}, "executive_analysis": {"Overview": "CVE-2024-39691 is a vulnerability in the matrix-appservice-irc 2.0.0 that allows an attacker to fabricate a timestamp and trick the bridge into leaking room messages.", "Business Impact": "This vulnerability has the potential to compromise sensitive information and impact business operations.", "Technical Impact": "The vulnerability affects Matrix IRC bridges before version 2.0.1 and may lead to unauthorized access to room messages.", "Mitigation Strategies": "Implement robust authentication, authorization, and auditing mechanisms and regularly review system logs for evidence of unauthorized access.", "Recommendations": "Recommendations include updating to the latest version of matrix-appservice-irc and implementing regular security audits.", "Conclusions": "CVE-2024-39691 highlights the importance of consistent security practices and regular risk assessments in Matrix IRC environments."}}