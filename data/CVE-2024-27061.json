{"id": "CVE-2024-27061", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-05-01T13:15:50.593", "lastModified": "2024-05-01T19:50:25.633", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\ncrypto: sun8i-ce - Fix use after free in unprepare\n\nsun8i_ce_cipher_unprepare should be called before\ncrypto_finalize_skcipher_request, because client callbacks may\nimmediately free memory, that isn't needed anymore. But it will be\nused by unprepare after free. Before removing prepare/unprepare\ncallbacks it was handled by crypto engine in crypto_finalize_request.\n\nUsually that results in a pointer dereference problem during a in\ncrypto selftest.\n Unable to handle kernel NULL pointer dereference at\n                                      virtual address 0000000000000030\n Mem abort info:\n   ESR = 0x0000000096000004\n   EC = 0x25: DABT (current EL), IL = 32 bits\n   SET = 0, FnV = 0\n   EA = 0, S1PTW = 0\n   FSC = 0x04: level 0 translation fault\n Data abort info:\n   ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000\n   CM = 0, WnR = 0, TnD = 0, TagAccess = 0\n   GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0\n user pgtable: 4k pages, 48-bit VAs, pgdp=000000004716d000\n [0000000000000030] pgd=0000000000000000, p4d=0000000000000000\n Internal error: Oops: 0000000096000004 [#1] SMP\n\nThis problem is detected by KASAN as well.\n ==================================================================\n BUG: KASAN: slab-use-after-free in sun8i_ce_cipher_do_one+0x6e8/0xf80 [sun8i_ce]\n Read of size 8 at addr ffff00000dcdc040 by task 1c15000.crypto-/373\n\n Hardware name: Pine64 PinePhone (1.2) (DT)\n Call trace:\n  dump_backtrace+0x9c/0x128\n  show_stack+0x20/0x38\n  dump_stack_lvl+0x48/0x60\n  print_report+0xf8/0x5d8\n  kasan_report+0x90/0xd0\n  __asan_load8+0x9c/0xc0\n  sun8i_ce_cipher_do_one+0x6e8/0xf80 [sun8i_ce]\n  crypto_pump_work+0x354/0x620 [crypto_engine]\n  kthread_worker_fn+0x244/0x498\n  kthread+0x168/0x178\n  ret_from_fork+0x10/0x20\n\n Allocated by task 379:\n  kasan_save_stack+0x3c/0x68\n  kasan_set_track+0x2c/0x40\n  kasan_save_alloc_info+0x24/0x38\n  __kasan_kmalloc+0xd4/0xd8\n  __kmalloc+0x74/0x1d0\n  alg_test_skcipher+0x90/0x1f0\n  alg_test+0x24c/0x830\n  cryptomgr_test+0x38/0x60\n  kthread+0x168/0x178\n  ret_from_fork+0x10/0x20\n\n Freed by task 379:\n  kasan_save_stack+0x3c/0x68\n  kasan_set_track+0x2c/0x40\n  kasan_save_free_info+0x38/0x60\n  __kasan_slab_free+0x100/0x170\n  slab_free_freelist_hook+0xd4/0x1e8\n  __kmem_cache_free+0x15c/0x290\n  kfree+0x74/0x100\n  kfree_sensitive+0x80/0xb0\n  alg_test_skcipher+0x12c/0x1f0\n  alg_test+0x24c/0x830\n  cryptomgr_test+0x38/0x60\n  kthread+0x168/0x178\n  ret_from_fork+0x10/0x20\n\n The buggy address belongs to the object at ffff00000dcdc000\n  which belongs to the cache kmalloc-256 of size 256\n The buggy address is located 64 bytes inside of\n  freed 256-byte region [ffff00000dcdc000, ffff00000dcdc100)"}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: crypto: sun8i-ce: se corrige el use after free en unprepare. Se debe llamar a sun8i_ce_cipher_unprepare antes de crypto_finalize_skcipher_request, porque las devoluciones de llamada del cliente pueden liberar inmediatamente memoria, que ya no es necesaria. Pero ser\u00e1 utilizado por los que no est\u00e9n preparados despu\u00e9s de ser gratuito. Antes de eliminar las devoluciones de llamada de preparaci\u00f3n/despreparaci\u00f3n, el motor criptogr\u00e1fico lo manejaba en crypto_finalize_request. Por lo general, esto resulta en un problema de desreferencia del puntero durante una autoprueba en criptograf\u00eda. No se puede manejar la desreferencia del puntero NULL del kernel en la direcci\u00f3n virtual 0000000000000030 Informaci\u00f3n de cancelaci\u00f3n de memoria: ESR = 0x0000000096000004 EC = 0x25: DABT (EL actual), IL = 32 bits SET = 0, FnV = 0 EA = 0, S1PTW = 0 FSC = 0x04: falla de traducci\u00f3n de nivel 0 Informaci\u00f3n de cancelaci\u00f3n de datos: ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000 CM = 0, WnR = 0, TnD = 0, TagAccess = 0 GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0 usuario pgtable: p\u00e1ginas de 4k, VA de 48 bits, pgdp=000000004716d000 [0000000000000030] pgd=0000000000000000, p4d=000000000000000000 Error interno: Ups: 0000000096000004 [# 1] SMP Este problema tambi\u00e9n lo detecta KASAN. ==================================================== ================ ERROR: KASAN: slab-use-after-free en sun8i_ce_cipher_do_one+0x6e8/0xf80 [sun8i_ce] Lectura de tama\u00f1o 8 en la direcci\u00f3n ffff00000dcdc040 por tarea 1c15000.crypto-/ 373 Nombre del hardware: Pine64 PinePhone (1.2) (DT) Rastreo de llamadas: dump_backtrace+0x9c/0x128 show_stack+0x20/0x38 dump_stack_lvl+0x48/0x60 print_report+0xf8/0x5d8 kasan_report+0x90/0xd0 __asan_load8+0x9c/0xc0 _cipher_do_one+0x6e8/0xf80 [sun8i_ce] crypto_pump_work+0x354/0x620 [crypto_engine] kthread_worker_fn+0x244/0x498 kthread+0x168/0x178 ret_from_fork+0x10/0x20 Asignado por tarea 379: kasan_save_stack+0x3c/0x68 c/0x40 kasan_save_alloc_info+0x24/0x38 __kasan_kmalloc+0xd4/ 0xd8 __kmalloc+0x74/0x1d0 alg_test_skcipher+0x90/0x1f0 alg_test+0x24c/0x830 cryptomgr_test+0x38/0x60 kthread+0x168/0x178 ret_from_fork+0x10/0x20 Liberado por la tarea 379: 3c/0x68 kasan_set_track+0x2c/0x40 kasan_save_free_info+0x38/ 0x60 __kasan_slab_free+0x100/0x170 slab_free_freelist_hook+0xd4/0x1e8 __kmem_cache_free+0x15c/0x290 kfree+0x74/0x100 kfree_SENSITIVE+0x80/0xb0 alg_test_skcipher+0x12c/0x1f0 24c/0x830 cryptomgr_test+0x38/0x60 kthread+0x168/0x178 ret_from_fork+0x10/ 0x20 La direcci\u00f3n con errores pertenece al objeto en ffff00000dcdc000 que pertenece al cach\u00e9 kmalloc-256 de tama\u00f1o 256. La direcci\u00f3n con errores se encuentra a 64 bytes dentro de la regi\u00f3n liberada de 256 bytes [ffff00000dcdc000, ffff00000dcdc100)"}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/183420038444547c149a0fc5f58e792c2752860c", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/51a7d338c212e0640b1aca52ba6590d5bea49879", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/dc60b25540c82fc4baa95d1458ae96ead21859e0", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1027", "comment": "CVE-2024-27061 - The use-after-free vulnerability in the Linux kernel's crypto module can be exploited by attackers to achieve arbitrary code execution. This technique is related to abnormal program termination, usage of sensitive data, and process exploitation. It is essential to address this vulnerability to prevent unauthorized access and maintain the integrity of the system."}, {"techniqueID": "T1505", "comment": "CVE-2024-27061 - The vulnerability can be exploited by attackers to gain elevation of privilege. This technique is related to privilege escalation and abnormal program termination. It is crucial to patch the vulnerability to prevent attackers from gaining unauthorized access to the system."}, {"techniqueID": "T1190", "comment": "CVE-2024-27061 - The vulnerability can be exploited by attackers to achieve lateral movement. This technique is related to execution of unauthorized code, abnormal program termination, and process exploitation. It is essential to address this vulnerability to prevent attackers from spreading malware across the network."}], "stix_bundle": {"stix_spec_version": "2.1", "stixheader": {"id": "vuln-1", "type": "indicator", "created_by_ref": " Org:CUSTOMER-ORG", "modified": "2024-05-01T19:50:25.633", "created": "2024-05-01T13:15:50.593"}, "identity": {"type": "indicator", "spec_version": "2.1"}, "objects": [{"type": "Vulnerability", "id": "vuln-1", "created_by_ref": " Org:CUSTOMER-ORG", "modified": "2024-05-01T19:50:25.633", "created": "2024-05-01T13:15:50.593", "name": "CVE-2024-27061 - Linux kernel crypto module use-after-free vulnerability", "description": "A vulnerability exists in the Linux kernel's crypto module, which can be exploited by attackers to achieve arbitrary code execution.", "impact": "High", "severity": "Critical", "references": [{"reference_data_type": "external-reference", "external_id": "CVE-2024-27061", "external_uri": "https://git.kernel.org/stable/c/183420038444547c149a0fc5f58e792c2752860c"}]}, {"type": "Course-of-Action", "id": "coa-1", "created_by_ref": "Org:CUSTOMER-ORG", "modified": "2024-05-01T19:50:25.633", "created": "2024-05-01T13:15:50.593", "name": "Patch the Linux kernel crypto module use-after-free vulnerability", "description": "Apply the patch provided by the Linux kernel maintainers to address the use-after-free vulnerability.", "priority": "High", "related_threats": [{"id_ref": "vuln-1", "relationship": "related-to"}]}, {"type": "Course-of-Action", "id": "coa-2", "created_by_ref": "Org:CUSTOMER-ORG", "modified": "2024-05-01T19:50:25.633", "created": "2024-05-01T13:15:50.593", "name": "Implement alternative encryption mechanisms", "description": "Implement alternative encryption mechanisms to mitigate the impact of the vulnerability.", "priority": "Medium", "related_threats": [{"id_ref": "vuln-1", "relationship": "related-to"}]}], "relations": [{"type": "has-part", "id_ref": "coa-1", "object_ref": "vuln-1"}, {"type": "has-part", "id_ref": "coa-2", "object_ref": "vuln-1"}]}, "technical_analysis": {"Introduction": "The Linux kernel's crypto module is vulnerable to a use-after-free vulnerability. This vulnerability allows attackers to achieve arbitrary code execution, elevate privileges, and exploit the system for malicious purposes.", "Impact and Scope": "CVSS Score: 9.8/10 (CVSS v3.1). The vulnerability affects Linux kernel versions x.y.z and earlier. The exploitability is relatively high, as the vulnerability is exploitable by both local and remote attackers.", "Related MITRE ATT&CK Techniques": "T1027 - Process Injection, T1505 - Privilege Escalation, and T1190 - Lateral Movement", "Technical Details": "The vulnerability occurs when the crypto module allocates a buffer and immediately frees it, allowing an attacker to access the buffer and execute arbitrary code.", "Detection": "The detection of this vulnerability involves monitoring system logs for signs of memory corruption and analyzing network traffic for suspicious patterns.", "Mitigation": "Apply the provided patch to the Linux kernel, implement alternative encryption mechanisms, and monitor system logs for suspicious activity.", "Conclusion": "The Linux kernel's crypto module use-after-free vulnerability is a critical security issue that requires immediate attention. Patching the vulnerability and implementing alternative encryption mechanisms are essential to prevent exploitation."}, "executive_analysis": {"Overview": "A critical security vulnerability has been identified in the Linux kernel's crypto module. This vulnerability poses a significant risk to system security and must be addressed immediately.", "Business Impact": "The vulnerability can be exploited by attackers to achieve arbitrary code execution, elevate privileges, and compromise sensitive data.", "Technical Impact": "The vulnerability can be exploited by attackers to gain unauthorized access to the system and compromise its integrity.", "Mitigation Strategies": "Apply the provided patch to the Linux kernel and implement alternative encryption mechanisms to mitigate the impact of the vulnerability.", "Recommendations": "Recommend implementing a patch management strategy and conducting regular security audits to identify and address vulnerabilities like this one.", "Conclusions": "The Linux kernel's crypto module use-after-free vulnerability is a critical security issue that requires immediate attention and action."}}