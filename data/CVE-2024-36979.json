{"id": "CVE-2024-36979", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-06-19T14:15:13.620", "lastModified": "2024-08-26T12:48:19.597", "vulnStatus": "Analyzed", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet: bridge: mst: fix vlan use-after-free\n\nsyzbot reported a suspicious rcu usage[1] in bridge's mst code. While\nfixing it I noticed that nothing prevents a vlan to be freed while\nwalking the list from the same path (br forward delay timer). Fix the rcu\nusage and also make sure we are not accessing freed memory by making\nbr_mst_vlan_set_state use rcu read lock.\n\n[1]\n WARNING: suspicious RCU usage\n 6.9.0-rc6-syzkaller #0 Not tainted\n -----------------------------\n net/bridge/br_private.h:1599 suspicious rcu_dereference_protected() usage!\n ...\n stack backtrace:\n CPU: 1 PID: 8017 Comm: syz-executor.1 Not tainted 6.9.0-rc6-syzkaller #0\n Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 03/27/2024\n Call Trace:\n  <IRQ>\n  __dump_stack lib/dump_stack.c:88 [inline]\n  dump_stack_lvl+0x241/0x360 lib/dump_stack.c:114\n  lockdep_rcu_suspicious+0x221/0x340 kernel/locking/lockdep.c:6712\n  nbp_vlan_group net/bridge/br_private.h:1599 [inline]\n  br_mst_set_state+0x1ea/0x650 net/bridge/br_mst.c:105\n  br_set_state+0x28a/0x7b0 net/bridge/br_stp.c:47\n  br_forward_delay_timer_expired+0x176/0x440 net/bridge/br_stp_timer.c:88\n  call_timer_fn+0x18e/0x650 kernel/time/timer.c:1793\n  expire_timers kernel/time/timer.c:1844 [inline]\n  __run_timers kernel/time/timer.c:2418 [inline]\n  __run_timer_base+0x66a/0x8e0 kernel/time/timer.c:2429\n  run_timer_base kernel/time/timer.c:2438 [inline]\n  run_timer_softirq+0xb7/0x170 kernel/time/timer.c:2448\n  __do_softirq+0x2c6/0x980 kernel/softirq.c:554\n  invoke_softirq kernel/softirq.c:428 [inline]\n  __irq_exit_rcu+0xf2/0x1c0 kernel/softirq.c:633\n  irq_exit_rcu+0x9/0x30 kernel/softirq.c:645\n  instr_sysvec_apic_timer_interrupt arch/x86/kernel/apic/apic.c:1043 [inline]\n  sysvec_apic_timer_interrupt+0xa6/0xc0 arch/x86/kernel/apic/apic.c:1043\n  </IRQ>\n  <TASK>\n asm_sysvec_apic_timer_interrupt+0x1a/0x20 arch/x86/include/asm/idtentry.h:702\n RIP: 0010:lock_acquire+0x264/0x550 kernel/locking/lockdep.c:5758\n Code: 2b 00 74 08 4c 89 f7 e8 ba d1 84 00 f6 44 24 61 02 0f 85 85 01 00 00 41 f7 c7 00 02 00 00 74 01 fb 48 c7 44 24 40 0e 36 e0 45 <4b> c7 44 25 00 00 00 00 00 43 c7 44 25 09 00 00 00 00 43 c7 44 25\n RSP: 0018:ffffc90013657100 EFLAGS: 00000206\n RAX: 0000000000000001 RBX: 1ffff920026cae2c RCX: 0000000000000001\n RDX: dffffc0000000000 RSI: ffffffff8bcaca00 RDI: ffffffff8c1eaa60\n RBP: ffffc90013657260 R08: ffffffff92efe507 R09: 1ffffffff25dfca0\n R10: dffffc0000000000 R11: fffffbfff25dfca1 R12: 1ffff920026cae28\n R13: dffffc0000000000 R14: ffffc90013657160 R15: 0000000000000246"}, {"lang": "es", "value": "En el kernel de Linux, se resolvi\u00f3 la siguiente vulnerabilidad: net: bridge: mst: fix vlan use-after-free syzbot inform\u00f3 un uso sospechoso de rcu[1] en el c\u00f3digo mst del puente. Mientras lo solucionaba, not\u00e9 que nada impide que se libere una VLAN mientras se recorre la lista desde el mismo camino (br temporizador de retardo de avance). Corrija el uso de rcu y tambi\u00e9n aseg\u00farese de que no accedamos a la memoria liberada haciendo que br_mst_vlan_set_state use el bloqueo de lectura de rcu. [1] ADVERTENCIA: uso sospechoso de RCU 6.9.0-rc6-syzkaller #0 No contaminado ----------------------- net/ bridge/br_private.h:1599 \u00a1uso sospechoso de rcu_dereference_protected()! ... seguimiento de pila: CPU: 1 PID: 8017 Comm: syz-executor.1 No contaminado 6.9.0-rc6-syzkaller #0 Nombre del hardware: Google Google Compute Engine/Google Compute Engine, BIOS Google 27/03/2024 Llamada Seguimiento:  __dump_stack lib/dump_stack.c:88 [en l\u00ednea] dump_stack_lvl+0x241/0x360 lib/dump_stack.c:114 lockdep_rcu_suspicious+0x221/0x340 kernel/locking/lockdep.c:6712 nbp_vlan_group net/bridge/br_private.h :1599 [en l\u00ednea] br_mst_set_state+0x1ea/0x650 net/bridge/br_mst.c:105 br_set_state+0x28a/0x7b0 net/bridge/br_stp.c:47 br_forward_delay_timer_expired+0x176/0x440 net/bridge/br_stp_timer.c:88 n+0x18e /0x650 kernel/time/timer.c:1793 expire_timers kernel/time/timer.c:1844 [en l\u00ednea] __run_timers kernel/time/timer.c:2418 [en l\u00ednea] __run_timer_base+0x66a/0x8e0 kernel/time/timer.c: 2429 run_timer_base kernel/time/timer.c:2438 [en l\u00ednea] run_timer_softirq+0xb7/0x170 kernel/time/timer.c:2448 __do_softirq+0x2c6/0x980 kernel/softirq.c:554 invoke_softirq kernel/softirq.c:428 [en l\u00ednea ] __irq_exit_rcu+0xf2/0x1c0 kernel/softirq.c:633 irq_exit_rcu+0x9/0x30 kernel/softirq.c:645 instr_sysvec_apic_timer_interrupt arch/x86/kernel/apic/apic.c:1043 [en l\u00ednea] 0xc0 arco/x86 /kernel/apic/apic.c:1043   asm_sysvec_apic_timer_interrupt+0x1a/0x20 arch/x86/include/asm/idtentry.h:702 RIP: 0010:lock_acquire+0x264/0x550 kernel/locking/lockdep. c:5758 C\u00f3digo: 2b 00 74 08 4c 89 f7 e8 ba d1 84 00 f6 44 24 61 02 0f 85 85 01 00 00 41 f7 c7 00 02 00 00 74 01 fb 48 c7 44 24 40 0e 36 e0 &lt;4b&gt; c7 44 25 00 00 00 00 00 43 c7 44 25 09 00 00 00 00 43 c7 44 25 RSP: 0018:ffffc90013657100 EFLAGS: 00000206 RAX: 0000000000000001 RBX: ffff920026cae2c RCX: 0000000000000001 RDX: dffffc0000000000 RSI: ffffffff8bcaca00 RDI: ffffffff8c1eaa60 RBP: ffffc90013657260 R08: ffffffff92efe507 R09: 1ffffffff25dfca0 R10: dffffc0000000000 R11: ffffbfff25dfca1 R12: 1ffff920026cae28 R13: dffffc0000000000 R14: ffffc90013657160 5: 0000000000000246"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.8, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-416"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.18", "versionEndExcluding": "6.1.93", "matchCriteriaId": "1F607CCF-2E38-46A2-8403-EE0DC522FA61"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.2", "versionEndExcluding": "6.6.33", "matchCriteriaId": "FCE796DF-3B50-4DC6-BAE5-95271068FC9E"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.7", "versionEndExcluding": "6.8.12", "matchCriteriaId": "80550309-67AB-4FD1-AC07-3DED5C4F01B2"}, {"vulnerable": true, "criteria": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.9", "versionEndExcluding": "6.9.3", "matchCriteriaId": "E07124C1-19E8-4D21-828D-9932A01D3011"}]}]}], "references": [{"url": "https://git.kernel.org/stable/c/3a7c1661ae1383364cd6092d851f5e5da64d476b", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/4488617e5e995a09abe4d81add5fb165674edb59", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/8ca9a750fc711911ef616ceb627d07357b04545e", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/a2b01e65d9ba8af2bb086d3b7288ca53a07249ac", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/e43dd2b1ec746e105b7db5f9ad6ef14685a615a4", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "tags": ["Patch"]}], "techniques": [{"techniqueID": "T1190", "comment": "CVE-2024-36979 - Linux Kernel use-after-free vulnerability, attacker may exploit this to escalate privileges. Defend against it by patching the kernel and using memory safety features."}, {"techniqueID": "T1027", "comment": "CVE-2024-36979 - Linux Kernel use-after-free vulnerability, attacker may exploit this to elevate privileges and access sensitive data. Defend against it by implementing memory safety features and using disk encryption."}], "stix_bundle": {"objects": [{"type": "indicator", "id": "indicator--4767a2a0-c9e5-44f1-b58b-e66fc4f9f13b", "name": "CVE-2024-36979 Linux Kernel use-after-free vulnerability"}, {"type": "attack-pattern", "id": "attack-pattern--8f2a6f33-2d6c-4f8d-a86a-7c4e2c3e6f45", "name": "Linux Kernel use-after-free vulnerability exploitation"}, {"type": "course-of-action", "id": "course-of-action--f5e3c3f3-02e1-464d-a1f2-bd41e1a1b4fa", "name": "Patch the Linux Kernel and use memory safety features", "description": "Apply the patches and configure the system to use memory safety features to prevent exploitation of the vulnerability."}, {"type": "observable", "id": "observable--5f3cc1a9-cc41-4a94-98cf-7cc6f09cb9c6", "name": "Linux Kernel use-after-free vulnerability detection", "description": "Detect the vulnerability by analyzing system logs and monitoring for suspicious memory access patterns."}], "relationship": [{"source-ref": "indicator--4767a2a0-c9e5-44f1-b58b-e66fc4f9f13b", "target-ref": "attack-pattern--8f2a6f33-2d6c-4f8d-a86a-7c4e2c3e6f45", "relationship-type": "related-to"}, {"source-ref": "attack-pattern--8f2a6f33-2d6c-4f8d-a86a-7c4e2c3e6f45", "target-ref": "course-of-action--f5e3c3f3-02e1-464d-a1f2-bd41e1a1b4fa", "relationship-type": "mitigates"}, {"source-ref": "course-of-action--f5e3c3f3-02e1-464d-a1f2-bd41e1a1b4fa", "target-ref": "observable--5f3cc1a9-cc41-4a94-98cf-7cc6f09cb9c6", "relationship-type": "Detection"}]}, "technical_analysis": {"Introduction": "The CVE-2024-36979 Linux Kernel use-after-free vulnerability allows attackers to escalate privileges and access sensitive data.", "Impact and Scope": "CVSS score: 7.8, Attack Vector: LOCAL, Impact: HIGH, Confidentiality: HIGH, Integrity: HIGH, Availability: HIGH.", "Related MITRE ATT&CK Techniques": "T1190, T1027", "Technical Details": "The vulnerability is caused by a use-after-free error in the Linux Kernel, allowing attackers to exploit it and escalate privileges.", "Detection": "Detect the vulnerability by monitoring system logs and network traffic for suspicious behavior.", "Mitigation": "Patch the Linux Kernel, use memory safety features, and enable disk encryption.", "Conclusion": "The CVE-2024-36979 Linux Kernel use-after-free vulnerability is a serious threat that requires immediate attention and action."}, "executive_analysis": {"Overview": "The CVE-2024-36979 Linux Kernel use-after-free vulnerability is a critical security issue that can be exploited by attackers to gain unauthorized access to sensitive data and escalate privileges.", "Business Impact": "The vulnerability can lead to significant financial losses, data breaches, and damage to reputation.", "Technical Impact": "The vulnerability can be exploited to gain access to sensitive data, escalate privileges, and disrupt business operations.", "Mitigation Strategies": "Patch the Linux Kernel, use memory safety features, and enable disk encryption.", "Recommendations": "Implement robust security measures, conduct regular security audits, and train employees on security best practices.", "Conclusions": "The CVE-2024-36979 Linux Kernel use-after-free vulnerability is a serious threat that requires immediate attention and action. Implementing robust security measures and patching the Linux Kernel can help prevent exploitation and minimize the risk of data breaches."}}