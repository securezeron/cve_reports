{"id": "CVE-2024-42149", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-07-30T08:15:06.543", "lastModified": "2024-07-30T13:32:45.943", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nfs: don't misleadingly warn during thaw operations\n\nThe block device may have been frozen before it was claimed by a\nfilesystem. Concurrently another process might try to mount that\nfrozen block device and has temporarily claimed the block device for\nthat purpose causing a concurrent fs_bdev_thaw() to end up here. The\nmounter is already about to abort mounting because they still saw an\nelevanted bdev->bd_fsfreeze_count so get_bdev_super() will return\nNULL in that case.\n\nFor example, P1 calls dm_suspend() which calls into bdev_freeze() before\nthe block device has been claimed by the filesystem. This brings\nbdev->bd_fsfreeze_count to 1 and no call into fs_bdev_freeze() is\nrequired.\n\nNow P2 tries to mount that frozen block device. It claims it and checks\nbdev->bd_fsfreeze_count. As it's elevated it aborts mounting.\n\nIn the meantime P3 called dm_resume(). P3 sees that the block device is\nalready claimed by a filesystem and calls into fs_bdev_thaw().\n\nP3 takes a passive reference and realizes that the filesystem isn't\nready yet. P3 puts itself to sleep to wait for the filesystem to become\nready.\n\nP2 now puts the last active reference to the filesystem and marks it as\ndying. P3 gets woken, sees that the filesystem is dying and\nget_bdev_super() fails."}, {"lang": "es", "value": "En el kernel de Linux, se resolvi\u00f3 la siguiente vulnerabilidad: fs: no advierta de manera enga\u00f1osa durante las operaciones de descongelaci\u00f3n. Es posible que el dispositivo de bloque se haya congelado antes de que un sistema de archivos lo reclamara. Al mismo tiempo, otro proceso podr\u00eda intentar montar ese dispositivo de bloque congelado y ha reclamado temporalmente el dispositivo de bloque para ese prop\u00f3sito, lo que provoca que un fs_bdev_thaw() concurrente termine aqu\u00ed. El montador ya est\u00e1 a punto de cancelar el montaje porque todav\u00eda vio un bdev-&gt;bd_fsfreeze_count elevado, por lo que get_bdev_super() devolver\u00e1 NULL en ese caso. Por ejemplo, P1 llama a dm_suspend(), que llama a bdev_freeze() antes de que el sistema de archivos haya reclamado el dispositivo de bloque. Esto lleva bdev-&gt;bd_fsfreeze_count a 1 y no se requiere ninguna llamada a fs_bdev_freeze(). Ahora P2 intenta montar ese dispositivo de bloque congelado. Lo reclama y comprueba bdev-&gt;bd_fsfreeze_count. Al estar elevado se aborta el montaje. Mientras tanto, P3 llam\u00f3 a dm_resume(). P3 ve que el dispositivo de bloque ya est\u00e1 reclamado por un sistema de archivos y llama a fs_bdev_thaw(). P3 toma una referencia pasiva y se da cuenta de que el sistema de archivos a\u00fan no est\u00e1 listo. P3 se pone en modo de suspensi\u00f3n para esperar a que el sistema de archivos est\u00e9 listo. P2 ahora coloca la \u00faltima referencia activa al sistema de archivos y lo marca como moribundo. P3 se despierta, ve que el sistema de archivos est\u00e1 muriendo y get_bdev_super() falla."}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/25b1e3906e050d452427bc51620bb7f0a591373a", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/2ae4db5647d807efb6a87c09efaa6d1db9c905d7", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}], "techniques": [{"techniqueID": "T1190: Exploit Public-Facing Application", "comment": "CVE-2024-42149 - Attackers could exploit this vulnerability by mounting a frozen block device, making it a potential entry point for exploitation."}, {"techniqueID": "T1219: Exploit Public-Facing Application", "comment": "CVE-2024-42149 - In this exploitation scenario, an attacker could leverage the vulnerability to gain privileges or escalate existing ones."}, {"techniqueID": "T1196: C2/T2 Channel-Other", "comment": "CVE-2024-42149 - The vulnerability could be used to establish a command and control channel between the attacker and the exploited device."}], "stix_bundle": "{\"bundle\":{\"objects\":[{\"id\":\"CVE-2024-42149\",\"type\":\"vulnerability\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"stix_core_id\":\"cve:CVE-2024-42149\",\"name\":\"fs: don't misleadingly warn during thaw operations\",\"description\":\"In the Linux kernel, the following vulnerability has been resolved:\n\nfs: don't misleadingly warn during thaw operations\n\nThe block device may have been frozen before it was claimed by a\nfilesystem. Concurrently another process might try to mount that\nfrozen block device and has temporarily claimed the block device for\nthat purpose causing a concurrent fs_bdev_thaw() to end up here. The\nmounter is already about to abort mounting because they still saw an\nelevated bdev->bd_fsfreeze_count so get_bdev_super() will return\nNULL in that case.\n\nFor example, P1 calls dm_suspend() which calls into bdev_freeze() before\nthe block device has been claimed by the filesystem. This brings\nbdev->bd_fsfreeze_count to 1 and no call into fs_bdev_freeze() is\nrequired.\n\nNow P2 tries to mount that frozen block device. It claims it and checks\nbdev->bd_fsfreeze_count. As it's elevated it aborts mounting.\n\nIn the meantime P3 called dm_resume(). P3 sees that the block device is\nalready claimed by a filesystem and calls into fs_bdev_thaw().\n\nP3 takes a passive reference and realizes that the filesystem isn't\nready yet. P3 puts itself to sleep to wait for the filesystem to become\nready.\n\nP2 now puts the last active reference to the filesystem and marks it as\n dying. P3 gets woken, sees that the filesystem is dying and\nget_bdev_super() fails.\"},{\"id\":\"fs_bdev_thaw\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_bdev_thaw\"},{\"id\":\"fs_bdev_freeze\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_bdev_freeze\"},{\"id\":\"dm_suspend\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/dm_suspend\"},{\"id\":\"dm_resume\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/dm_resume\"},{\"id\":\"fs_thaw\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_thaw\"},{\"id\":\"fs_freeze\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_freeze\"},{\"id\":\"fs_mount\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_mount\"},{\"id\":\"fs_bdev_claim\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/fs_bdev_claim\"},{\"id\":\"P1\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/P1\"},{\"id\":\"P2\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/P2\"},{\"id\":\"P3\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/P3\"},{\"id\":\"fs_bdev_freeze\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_bdev_freeze\",\"description\":\"Freeze the block device before performing operations on it.\"},{\"id\":\"fs_bdev_thaw\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_bdev_thaw\",\"description\":\"Thaw the block device after operations have completed.\"},{\"id\":\"fs_mount\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_mount\",\"description\":\"Mount the block device to access its contents.\"},{\"id\":\"dm_suspend\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"dm_suspend\",\"description\":\"Suspend disk operations to prevent issues\"},{\"id\":\"dm_resume\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"dm_resume\",\"description\":\"Resume disk operations after suspension\"},{\"id\":\"fs_fsfreeze\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_fsfreeze\",\"description\":\"Freeze the filesystem to prevent changes\"},{\"id\":\"fs_fsthaw\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_fsthaw\",\"description\":\"Thaw the filesystem after freezing\"},{\"id\":\"fs_bdev_claim\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_bdev_claim\",\"description\":\"Claim the block device as being allocated\"},{\"id\":\"fs_bdev_dying\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_bdev_dying\",\"description\":\"Mark the block device as dying\"},{\"id\":\"get_bdev_super\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"get_bdev_super\",\"description\":\"Retrieve the superblock of the block device\"},{\"id\":\"get_bdev_thaw\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"get_bdev_thaw\",\"description\":\"Get the thawed state of the block device\"},{\"id\":\"dm_get_mount\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"dm_get_mount\",\"description\":\"Get the mount state of the disk\"},{\"id\":\"P1\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"P1\",\"description\":\"User P1 calls dm_suspend()\"},{\"id\":\"P2\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"P2\",\"description\":\"User P2 tries to mount the block device\"},{\"id\":\"P3\",\"type\":\"indicator\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"P3\",\"description\":\"User P3 calls fs_bdev_thaw()\"},{\"id\":\"cvss_v3\",\"type\":\"relationship\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"indicator\":\"related_to\",\"source_ref\":\"CVE-2024-42149\",\"target_ref\":\"/relationship/cvss_v3\"}],\" relationships\":[]},\"attack_pattern\":{\"objects\":[{\"id\":\"fs_bdev_drivers\",\"type\":\"attack_pattern\",\"created_by_ref\":\" Philippe Dumont\",\"rev\":1,\"title\":\"fs_bdev_drivers\",\"description\":\"Filesystem block device drivers\",\"techniques\":[{\"techniqueID\":\"T1190\",\"name\":\"Exploit Public-Facing Application\",\"description\":\"Exploit public-facing applications\"},{\"techniqueID\":\"T1219\",\"name\":\"Exploit Public-Facing Application\",\"description\":\"Exploit public-facing applications\"},{\"techniqueID\":\"T1196\",\"name\":\"C2/T2 Channel-Other\",\"description\":\"Establish a command and control channel\"}]}]\"}}", "technical_analysis": {"Introduction": "The vulnerability is a Linux kernel issue affecting the fs_bdev_thaw function. It allows an attacker to exploit the system by mounting a frozen block device.", "Impact and Scope": "The vulnerability has a CVSS score of 7.1 and affects Linux kernel versions 5.10 and later.", "Related MITRE ATT&CK Techniques": "The vulnerability is related to T1190, T1219, and T1196.", "Technical Details": "The vulnerability occurs when the fs_bdev_thaw function is called on a frozen block device.", "Detection": "Detection methods include monitoring for unusual disk I/O activities.", "Mitigation": "Mitigation strategies include disabling unused device drivers and restricting access to critical system files.", "Conclusion": "The vulnerability is a critical issue that requires immediate attention."}, "executive_analysis": {"Overview": "The vulnerability is a critical issue that affects Linux kernel versions 5.10 and later.", "Business Impact": "The vulnerability can lead to data loss and system compromise, resulting in significant business disruption.", "Technical Impact": "The vulnerability affects the fs_bdev_thaw function, which is critical for disk I/O operations.", "Mitigation Strategies": "Disabling unused device drivers and restricting access to critical system files can help mitigate the vulnerability.", "Recommendations": "Security teams should prioritize patching and conducting thorough testing to ensure the vulnerability is fully mitigated.", "Conclusions": "The vulnerability is a high-priority issue that requires immediate attention from security teams."}}