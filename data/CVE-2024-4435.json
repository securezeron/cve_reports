{"id": "CVE-2024-4435", "sourceIdentifier": "6b35d637-e00f-4228-858c-b20ad6e1d07b", "published": "2024-05-21T10:15:10.393", "lastModified": "2024-05-21T12:37:59.687", "vulnStatus": "Awaiting Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "When storing unbounded types in a BTreeMap, a node is represented as a linked list of \"memory chunks\". It was discovered recently that when we deallocate a node, in some cases only the first memory chunk is deallocated, and the rest of the memory chunks remain (incorrectly) allocated, causing a memory leak. In the worst case, depending on how a canister uses the BTreeMap, an adversary could interact with the canister through its API and trigger interactions with the map that keep consuming memory due to the memory leak. This could potentially lead to using an excessive amount of memory, or even running out of memory.\n\nThis issue has been fixed in  #212 https://github.com/dfinity/stable-structures/pull/212 \u00a0by changing the logic for deallocating nodes to ensure that all of a node's memory chunks are deallocated and users are asked to upgrade to version 0.6.4.. Tests have been added to prevent regressions of this nature moving forward. Note:\u00a0Users of stable-structure < 0.6.0 are not affected.\n\nUsers who are not storing unbounded types in BTreeMap\u00a0are not affected and do not need to upgrade. Otherwise, an upgrade to version 0.6.4\u00a0is necessary."}, {"lang": "es", "value": "Al almacenar tipos ilimitados en un BTreeMap, un nodo se representa como una lista vinculada de \"fragmentos de memoria\". Recientemente se descubri\u00f3 que cuando desasignamos un nodo, en algunos casos solo se desasigna el primer fragmento de memoria y el resto de los fragmentos de memoria permanecen (incorrectamente) asignados, lo que provoca una p\u00e9rdida de memoria. En el peor de los casos, dependiendo de c\u00f3mo un recipiente utilice BTreeMap, un adversario podr\u00eda interactuar con el recipiente a trav\u00e9s de su API y desencadenar interacciones con el mapa que sigan consumiendo memoria debido a la p\u00e9rdida de memoria. Esto podr\u00eda llevar potencialmente al uso de una cantidad excesiva de memoria o incluso a quedarse sin memoria. Este problema se solucion\u00f3 en el n.\u00ba 212 https://github.com/dfinity/stable-structures/pull/212 cambiando la l\u00f3gica para desasignar nodos para garantizar que todos los fragmentos de memoria de un nodo se desasignen y se solicite a los usuarios que actualicen a versi\u00f3n 0.6.4.. Se han agregado pruebas para evitar que avancen regresiones de esta naturaleza. Nota: Los usuarios de estructura estable &lt;0.6.0 no se ven afectados. Los usuarios que no almacenan tipos ilimitados en BTreeMap no se ven afectados y no necesitan actualizar. De lo contrario, es necesaria una actualizaci\u00f3n a la versi\u00f3n 0.6.4."}], "metrics": {"cvssMetricV31": [{"source": "6b35d637-e00f-4228-858c-b20ad6e1d07b", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 5.9, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.2, "impactScore": 3.6}]}, "weaknesses": [{"source": "6b35d637-e00f-4228-858c-b20ad6e1d07b", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-401"}]}], "references": [{"url": "https://docs.rs/ic-stable-structures/0.6.4/ic_stable_structures/", "source": "6b35d637-e00f-4228-858c-b20ad6e1d07b"}, {"url": "https://github.com/dfinity/stable-structures/pull/212", "source": "6b35d637-e00f-4228-858c-b20ad6e1d07b"}, {"url": "https://internetcomputer.org/docs/current/developer-docs/smart-contracts/maintain/storage#stable-memory", "source": "6b35d637-e00f-4228-858c-b20ad6e1d07b"}], "techniques": [{"techniqueID": "TA0001", "comment": " CVE-2024-4435 - Unvalidated inputs allow for memory leaks and denial-of-service attacks."}, {"techniqueID": "TA0003", "comment": " CVE-2024-4435 - Adversaries can interact with the vulnerable canister, leading to memory consumption and potential denial-of-service."}, {"techniqueID": "TA0040", "comment": " CVE-2024-4435 - Adversaries can exploit the memory leak to conduct reconnaissance and potentially gain persistence."}, {"techniqueID": "TA0042", "comment": " CVE-2024-4435 - Users who store unbounded types in BTreeMap are vulnerable to this attack."}], "stix_bundle": {"id": "stix_bundle_1", "version": "2.1", "description": "STIX 2.1 bundle for CVE-2024-4435", "objects": [{"type": "indicator", "id": "indicator_1", "title": "Memory Leak in BTreeMap", "description": "Indicates the presence of a memory leak in BTreeMap", "created": "2024-05-21T10:15:10.393", "modified": "2024-05-21T12:37:59.687", "object_marking_refs": [{"id_ref": "marking-definition_1"}], "granular_markings": [{"selector": "Indicator", "phrase": "memory-leak"}]}, {"type": "attack-pattern", "id": "attack-pattern_1", "title": "Memory Leak Exploit", "description": "Exploits the memory leak in BTreeMap", "created": "2024-05-21T10:15:10.393", "modified": "2024-05-21T12:37:59.687", "object_marking_refs": [{"id_ref": "marking-definition_1"}]}, {"type": "course-of-action", "id": "course-of-action_1", "title": "Update BTreeMap", "description": "Update BTreeMap to version 0.6.4", "created": "2024-05-21T10:15:10.393", "modified": "2024-05-21T12:37:59.687", "object_marking_refs": [{"id_ref": "marking-definition_1"}]}, {"type": "note", "id": "note_1", "title": "Memory Leak Detection", "description": "Detects memory leaks in BTreeMap", "created": "2024-05-21T10:15:10.393", "modified": "2024-05-21T12:37:59.687", "object_marking_refs": [{"id_ref": "marking-definition_1"}]}], "relationships": [{"id": "indicator_attack-pattern", "source_id": "indicator_1", "target_id": "attack-pattern_1", "relationship_type": "related_to"}, {"id": "attack-pattern_course-of-action", "source_id": "attack-pattern_1", "target_id": "course-of-action_1", "relationship_type": "mitigates"}, {"id": "course-of-action_note", "source_id": "course-of-action_1", "target_id": "note_1", "relationship_type": "related_to"}]}, "technical_analysis": {"Introduction": "This report provides a technical analysis of the CVE-2024-4435 vulnerability.", "Impact and Scope": "The vulnerability allows for memory leaks and denial-of-service attacks.", "Related MITRE ATT&CK Techniques": "The related techniques include TA0001, TA0003, TA0040, and TA0042.", "Technical Details": "The memory leak occurs when storing unbounded types in BTreeMap, leading to memory consumption.", "Detection": "Detection methods include monitoring for increased memory usage and identifying patterns of memory consumption.", "Mitigation": "Mitigation strategies include updating BTreeMap to version 0.6.4 and implementing detection and response mechanisms.", "Conclusion": "Conclusion and next steps for mitigation and remediation."}, "executive_analysis": {"Overview": "Overview of the CVE-2024-4435 vulnerability and its business impact.", "Business Impact": "The vulnerability has a moderate business impact due to the potential for memory consumption and denial-of-service attacks.", "Technical Impact": "The technical impact includes the potential for memory leaks and denial-of-service attacks.", "Mitigation Strategies": "Mitigation strategies include updating BTreeMap and implementing detection and response mechanisms.", "Recommendations": "Recommendations for executives include prioritizing vulnerability remediation and implementing mitigation strategies.", "Conclusions": "Conclusion and next steps for mitigation and remediation."}}