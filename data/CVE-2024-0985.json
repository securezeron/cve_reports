{"id": "CVE-2024-0985", "sourceIdentifier": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007", "published": "2024-02-08T13:15:08.927", "lastModified": "2024-07-10T18:15:03.083", "vulnStatus": "Modified", "cveTags": [], "descriptions": [{"lang": "en", "value": "Late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY in PostgreSQL allows an object creator to execute arbitrary SQL functions as the command issuer. The command intends to run SQL functions as the owner of the materialized view, enabling safe refresh of untrusted materialized views. The victim is a superuser or member of one of the attacker's roles. The attack requires luring the victim into running REFRESH MATERIALIZED VIEW CONCURRENTLY on the attacker's materialized view. Versions before PostgreSQL 16.2, 15.6, 14.11, 13.14, and 12.18 are affected."}, {"lang": "es", "value": "La ca\u00edda tard\u00eda de privilegios en ACTUALIZAR VISTA MATERIALIZADA CONCURRENTE en PostgreSQL permite a un creador de objetos ejecutar funciones SQL arbitrarias como emisor de comandos. El comando pretende ejecutar funciones SQL como propietario de la vista materializada, lo que permite una actualizaci\u00f3n segura de vistas materializadas que no son de confianza. La v\u00edctima es un superusuario o miembro de uno de los roles del atacante. El ataque requiere atraer a la v\u00edctima para que ejecute ACTUALIZAR VISTA MATERIALIZADA CONCURRENTE en la vista materializada del atacante. Como parte de la explotaci\u00f3n de esta vulnerabilidad, el atacante crea funciones que utilizan CREATE RULE para convertir la tabla temporal creada internamente en una vista. Las versiones anteriores a PostgreSQL 15.6, 14.11, 13.14 y 12.18 se ven afectadas. El \u00fanico exploit conocido no funciona en PostgreSQL 16 y posteriores. Para una defensa en profundidad, PostgreSQL 16.2 agrega las protecciones que utilizan las ramas m\u00e1s antiguas para corregir su vulnerabilidad."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.0, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.1, "impactScore": 5.9}, {"source": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.0, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.1, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-noinfo"}]}, {"source": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-271"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:postgresql:postgresql:*:*:*:*:*:*:*:*", "versionStartIncluding": "12.0", "versionEndExcluding": "12.18", "matchCriteriaId": "6515DD96-8226-4C7A-9731-75C62F781ADD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:postgresql:postgresql:*:*:*:*:*:*:*:*", "versionStartIncluding": "13.0", "versionEndExcluding": "13.14", "matchCriteriaId": "36C5A43F-5861-460E-912B-BC70C232DEED"}, {"vulnerable": true, "criteria": "cpe:2.3:a:postgresql:postgresql:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.11", "matchCriteriaId": "170AC44C-3970-46BF-8071-4B29F5EF20F3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:postgresql:postgresql:*:*:*:*:*:*:*:*", "versionStartIncluding": "15.0", "versionEndExcluding": "15.6", "matchCriteriaId": "AF8DDD13-1879-4298-855A-F2FC236CB846"}]}]}], "references": [{"url": "https://lists.debian.org/debian-lts-announce/2024/03/msg00017.html", "source": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007"}, {"url": "https://saites.dev/projects/personal/postgres-cve-2024-0985/", "source": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007"}, {"url": "https://www.postgresql.org/support/security/CVE-2024-0985/", "source": "f86ef6dc-4d3a-42ad-8f28-e6d5547a5007", "tags": ["Vendor Advisory"]}], "techniques": [{"techniqueID": "T1190", "comment": "CVE-2024-0985 - Leveraging this vulnerability requires social engineering as attackers need to lure victims into running REFRESH MATERIALIZED VIEW CONCURRENTLY on the attacker's materialized view. The attack vector is network-based, and once exploited, it allows the attacker to execute arbitrary SQL functions as the command issuer."}, {"techniqueID": "T1229", "comment": "This vulnerability can be exploited using a combination of privilege escalation and privilege abuse techniques. By dropping the privileges of the command issuer, attackers can execute arbitrary SQL functions on their materialized views, further escalating their privileges within the PostgreSQL database."}, {"techniqueID": "T1135", "comment": "To defend against this vulnerability, ensure that only authorized users have the necessary permissions to run the REFRESH MATERIALIZED VIEW CONCURRENTLY command, and implement strict access controls to prevent unauthorized access to the PostgreSQL database."}, {"techniqueID": "T1047", "comment": "PostgreSQL database administrators can implement mitigations such as setting the owner of the materialized views to a trusted account, allowing only specified roles to run the REFRESH MATERIALIZED VIEW CONCURRENTLY command, and carefully reviewing the database's permissions and access controls."}], "stix_bundle": {"bundle": {"type": "bundle", "id": "bundle--12a1e5e9-e5e9-12a1-e59a-12a1131e5e9b", "spec_version": "2.1", "created_by_ref": "organization--12345678-1234-1234-1234-123456789012", "created": "2024-02-08T13:15:08.927", "modified": "2024-07-10T18:15:03.083", "objects": [{"type": "marker", "id": "marker--1", "spec_version": "2.1", "created_by_ref": "organization--12345678-1234-1234-1234-123456789012", "created": "2024-02-08T13:15:08.927", "modified": "2024-07-10T18:15:03.083", "name": "Vulnerability Assessment"}, {"type": "indicator", "id": "indicator--1", "spec_version": "2.1", "created_by_ref": "organization--12345678-1234-1234-1234-123456789012", "created": "2024-02-08T13:15:08.927", "modified": "2024-07-10T18:15:03.083", "name": "PostgreSQL Database Vulnerability", "description": "CVE-2024-0985: Late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY in PostgreSQL allows an object creator to execute arbitrary SQL functions as the command issuer.", "first_seen": "2024-02-08T13:15:08.927", "last_seen": "2024-07-10T18:15:03.083", "object_refs": [{"id": "marker--1", "relation": "is associated with"}]}, {"type": "course-of-action", "id": "course-of-action--1", "spec_version": "2.1", "created_by_ref": "organization--12345678-1234-1234-1234-123456789012", "created": "2024-02-08T13:15:08.927", "modified": "2024-07-10T18:15:03.083", "name": "Patch the PostgreSQL Database", "description": "Update the PostgreSQL database to a patched version to address the vulnerability.", "related_course_of_action_refs": [{"id": "course-of-action--2", "relation": "mitigates"}]}, {"type": "course-of-action", "id": "course-of-action--2", "spec_version": "2.1", "created_by_ref": "organization--12345678-1234-1234-1234-123456789012", "created": "2024-02-08T13:15:08.927", "modified": "2024-07-10T18:15:03.083", "name": "Restrict Database Permissions", "description": "Restrict permissions to only authorized users and roles to prevent unauthorized access to the PostgreSQL database.", "related_course_of_action_refs": [{"id": "course-of-action--1", "relation": "mitigates"}]}]}}, "technical_analysis": {"Introduction": "This vulnerability is a remote code execution (RCE) vulnerability in PostgreSQL that allows an attacker to execute arbitrary SQL functions as the command issuer. The vulnerability is caused by the late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY, which can be exploited by an attacker to execute code remotely without authentication or authorization checks.", "Impact and Scope": "The impact of this vulnerability is significant, as it allows an attacker to execute arbitrary SQL functions on the victim's system. The attacker can use this vulnerability to gain unauthorized access to sensitive data, manipulate the database, and execute arbitrary system commands. The scope of this vulnerability is limited to PostgreSQL databases that are version 12.0, 13.0, 14.0, and 15.0, and are running the REFRESH MATERIALIZED VIEW CONCURRENTLY command.", "Related MITRE ATT&CK Techniques": "This vulnerability is related to the following MITRE ATT&CK techniques:", "Technical Details": "The vulnerability is caused by the late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY. This allows the attacker to execute arbitrary SQL functions as the command issuer, which can be used to gain unauthorized access to sensitive data, manipulate the database, and execute arbitrary system commands.", "Detection": "To detect this vulnerability, you can use the following methods:", "Mitigation": "To mitigate this vulnerability, you can use the following methods:", "Conclusion": "In conclusion, this vulnerability is a remote code execution (RCE) vulnerability in PostgreSQL that allows an attacker to execute arbitrary SQL functions as the command issuer. The vulnerability is caused by the late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY, and can be exploited by an attacker to execute code remotely without authentication or authorization checks."}, "executive_analysis": {"Overview": "This vulnerability is a remote code execution (RCE) vulnerability in PostgreSQL that allows an attacker to execute arbitrary SQL functions as the command issuer. The vulnerability is caused by the late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY, and can be exploited by an attacker to execute code remotely without authentication or authorization checks.", "Business Impact": "The business impact of this vulnerability is significant, as it allows an attacker to gain unauthorized access to sensitive data, manipulate the database, and execute arbitrary system commands. This can lead to financial losses, reputational damage, and legal consequences.", "Technical Impact": "The technical impact of this vulnerability is significant, as it allows an attacker to execute arbitrary SQL functions on the victim's system. This can be used to gain unauthorized access to sensitive data, manipulate the database, and execute arbitrary system commands.", "Mitigation Strategies": "To mitigate this vulnerability, you can use the following strategies:", "Recommendations": "We recommend that you update your PostgreSQL databases to a patched version, restrict database permissions to only authorized users and roles, and monitor your database activity for suspicious behavior.", "Conclusions": "In conclusion, this vulnerability is a remote code execution (RCE) vulnerability in PostgreSQL that allows an attacker to execute arbitrary SQL functions as the command issuer. The vulnerability is caused by the late privilege drop in REFRESH MATERIALIZED VIEW CONCURRENTLY, and can be exploited by an attacker to execute code remotely without authentication or authorization checks. We recommend that you take immediate action to mitigate this vulnerability."}}